"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[9775],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},91841:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column","title":"PostgreSQL Update JSONB Column","description":"\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c","source":"@site/docs/14_PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column.md","sourceDirName":"14_PostgreSQL/JSONB","slug":"/PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"PostgreSQL Update JSONB Column","description":"\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c","keywords":["JSONB","PostgreSQL"]},"sidebar":"totem_sidebar","previous":{"title":"PostgreSQL Format JSONB Object","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Format_JSONB_Object"},"next":{"title":"PostgreSQL find value by Attr from JSONB","permalink":"/docs/PostgreSQL/JSONB/Postgresql_find_value_by_Attr_of_JSONB_column"}}');var r=s(74848),i=s(28453);const o={title:"PostgreSQL Update JSONB Column",description:"\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c",keywords:["JSONB","PostgreSQL"]},l="\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c",c={},d=[];function a(e){const n={a:"a",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u66f4\u6539-postgresql-jsonb-\u6b04\u4f4d\u8cc7\u6599\u503c",children:"\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u60c5\u5883: Table \u5165\u5b78\u8003\u8a66\u8cc7\u6599\u8868(Entrance_Examination)"}),"\n"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"id(bigint)"}),(0,r.jsx)(n.th,{children:"Admission_Ticket(character)"}),(0,r.jsx)(n.th,{children:"raw_data(jsonb)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"1"}),(0,r.jsx)(n.td,{children:"AAA001"}),(0,r.jsx)(n.td,{children:'{"City":"TPE", "School":"NTU" , "Score":"60" }'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2"}),(0,r.jsx)(n.td,{children:"BBB001"}),(0,r.jsx)(n.td,{children:'{"City":"TYN", "School":"NCHU", "Score":"70" }'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"3"}),(0,r.jsx)(n.td,{children:"CCC001"}),(0,r.jsx)(n.td,{children:'{"City":"HSZ", "School":"NCCU", "Score":"80" }'})]})]})]}),"\n",(0,r.jsx)(n.h1,{id:"\u67e5\u8a62-jsonb-\u5c6c\u6027\u8cc7\u6599",children:"\u67e5\u8a62 JSONB \u5c6c\u6027\u8cc7\u6599"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528 ->> \u7b26\u865f\u9032\u884c JSONB \u6b04\u4f4d\u4e0b\u5c6c\u6027\u503c\u67e5\u8a62"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"  select raw_data ->> 'School' as \"School\" from Entrance_Examination where Admission_Ticket = 'AAA001';\n"})}),"\n",(0,r.jsx)(n.h1,{id:"\u66f4\u6539-jsonb-\u65b9\u5f0f",children:"\u66f4\u6539 JSONB \u65b9\u5f0f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u65b9\u5f0f\u4f86\u505a\u5c6c\u6027\u503c\u4fee\u6539\u3002"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"jsonb_set()"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"jsonb_insert()"})}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"\u66f4\u6539-jsonb-\u5c6c\u6027\u503c\u85c9\u7531-jsonb_set",children:"\u66f4\u6539 JSONB \u5c6c\u6027\u503c\u85c9\u7531 jsonb_set()"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"jsonb_set \u7f6e\u5165\u7269\u4ef6\uff0c\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599, Replacement"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f: jsonb column \u81f3\u5c11\u8981\u5148\u6709\u4e00\u500b\u7a7a\u7269\u4ef6(\u4e0d\u80fd\u70ba null)\u624d\u80fd\u9032\u884c set\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"create_if_missing \u9810\u8a2d\u70ba true\uff0c\u7576\u7121\u6b64 attribute \u6642\uff0cupdate \u8b8a insert\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8a9e\u6cd5:"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"\tjsonb_set(\r\n\t  target JSONB, path TEXT[], new_value JSONB[, create_if_missing BOOLEAN]\r\n\t) -> JSONB\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4e0b\u65b9 replacement \u7bc4\u4f8b: school NTU \u53d6\u4ee3\u6210 NCHU","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5c07\u5b78\u6821\u6539\u6210 NCHU (JSON \u7d50\u69cb\u672a\u6539\u8b8a)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'   update Entrance_Examination set raw_data = jsonb_set( raw_data, \'{School}\', \'"NCHU"\'::jsonb )\r\n           where Admission_Ticket = \'AAA001\';\r\n           \r\n--\x3e\r\n{\r\n  "City":"TPE", \r\n  "School":"NCHU" , \r\n  "Score":"60"  \r\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5c07\u5b78\u6821\u6539\u6210 NCHU\uff0c\u4e26\u8a2d\u5b9a\u5206\u6821\u70ba Taipei (School \u6539\u4e00\u500b JSON \u7d50\u69cb)"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'   update Entrance_Examination set raw_data = jsonb_set( raw_data, \'{School}\', \'{"Campus":"NCHU", "Branch_Campus":"Taipei"}\' )\r\n           where Admission_Ticket = \'AAA001\';\r\n           \r\n--\x3e\r\n"{\r\n    "City": "TPE",\r\n    "Score": "60",\r\n    "School": {\r\n        "Campus": "NCHU",\r\n        "Bbranch_Ccampus": "Taipei"\r\n    }\r\n}"           \n'})}),"\n",(0,r.jsx)(n.h1,{id:"\u65b0\u589e--jsonb-\u5c6c\u6027\u503c\u85c9\u7531-jsonb_insert",children:"\u65b0\u589e  JSONB \u5c6c\u6027\u503c\u85c9\u7531 jsonb_insert()"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"\tjsonb_insert(\r\n\t  target JSONB, path TEXT[], new_value JSONB[, insert_after BOOLEAN]\r\n\t) -> JSONB\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"update Entrance_Examination set raw_data = jsonb_insert( raw_data, '{Country}', '\"TW\"'::jsonb )\r\n           where Admission_Ticket = 'AAA001';\n"})}),"\n",(0,r.jsx)(n.h1,{id:"\u88dc\u9f4a-jsonb-\u5c6c\u6027\u503c\u9577\u5ea6",children:"\u88dc\u9f4a JSONB \u5c6c\u6027\u503c\u9577\u5ea6"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5206\u6578\u88dc0\u5230\u56db\u4f4d"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"--\u88dc\u96f6\uff0c\u8f49\u63db\u70ba jsonb \u505a update\r\nupdate Entrance_Examination \r\n     set raw_data = jsonb_set( raw_data, '{Score}', quote_ident(lpad(raw_data ->> 'Score', 4, '0'))::jsonb )\r\n     where Admission_Ticket = 'AAA001';\n"})}),"\n",(0,r.jsx)(n.h1,{id:"reference",children:"Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://stackoverflow.com/questions/40583639/update-multiple-values-in-a-jsonb-data-in-postgresql",children:'\u6279\u6b21\u66f4\u6539 Jsonb \u7684\u5167\u5bb9: \u4f7f\u7528 "||"'})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/9.5/functions-json.html",children:"https://www.postgresql.org/docs/9.5/functions-json.html"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);