"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[4065],{1819:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>o,contentTitle:()=>c,default:()=>j,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"PostgreSQL/JSONB/PostgreSQL_Jsonb_misc","title":"PostgreSQL Jsonb \u96dc\u9805\u7d00\u9304","description":"Jsonb \u76f8\u95dc\u96dc\u4e03\u96dc\u516b\u90fd\u8a18\u9019","source":"@site/docs/140_PostgreSQL/JSONB/000_PostgreSQL_Jsonb_misc.md","sourceDirName":"140_PostgreSQL/JSONB","slug":"/PostgreSQL/JSONB/PostgreSQL_Jsonb_misc","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Jsonb_misc","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"PostgreSQL Jsonb \u96dc\u9805\u7d00\u9304","description":"Jsonb \u76f8\u95dc\u96dc\u4e03\u96dc\u516b\u90fd\u8a18\u9019","keywords":["postgresql","Jsonb"]},"sidebar":"totem_sidebar","previous":{"title":"PostgreSQL \u5099\u4efd\u8207\u9084\u539f Blob","permalink":"/docs/PostgreSQL/Backup_Restore_BLOB_in_Postgres"},"next":{"title":"JSONB \u67e5\u8a62 key \u503c","permalink":"/docs/PostgreSQL/JSONB/Postgresql_find_value_by_Attr_of_JSONB_column"}}');var t=s(74848),i=s(28453);const l={title:"PostgreSQL Jsonb \u96dc\u9805\u7d00\u9304",description:"Jsonb \u76f8\u95dc\u96dc\u4e03\u96dc\u516b\u90fd\u8a18\u9019",keywords:["postgresql","Jsonb"]},c=void 0,o={},d=[{value:"Jsonb CRUD \u6703\u9019\u5e7e\u500b\u57fa\u672c\u5c31\u5920\u4e86 <span>\xa0</span>",id:"jsonb-crud-\u6703\u9019\u5e7e\u500b\u57fa\u672c\u5c31\u5920\u4e86-",level:2},{value:"<span><em><strong>Jsonb column \u5fc5\u5b78\u5167\u5bb9\u64cd\u4f5c</strong></em></span>",id:"jsonb-column-\u5fc5\u5b78\u5167\u5bb9\u64cd\u4f5c",level:3},{value:"PostgreSQL Jsonb \u96dc\u9805\u7d00\u9304",id:"postgresql-jsonb-\u96dc\u9805\u7d00\u9304",level:2},{value:"\u95dc\u65bc append \u65b0\u503c",id:"\u95dc\u65bc-append-\u65b0\u503c",level:2},{value:"\u81ea\u52d5\u7e2e\u6392 Jsonb \u67e5\u8a62\u7d50\u679c <code><strong>jsonb_pretty</strong></code>",id:"\u81ea\u52d5\u7e2e\u6392-jsonb-\u67e5\u8a62\u7d50\u679c-jsonb_pretty",level:2},{value:"\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599 insert/update: <code><strong>jsonb_set</strong></code>",id:"\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599-insertupdate-jsonb_set",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.h2,{id:"jsonb-crud-\u6703\u9019\u5e7e\u500b\u57fa\u672c\u5c31\u5920\u4e86-",children:["Jsonb CRUD \u6703\u9019\u5e7e\u500b\u57fa\u672c\u5c31\u5920\u4e86 ",(0,t.jsx)("span",{id:"Jsonb_fundamental",children:"\xa0"})]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u5beb\u5728\u6700\u524d\u9762: \u57fa\u672c\u4e0a\u6bcf\u500b\u64cd\u4f5c\u90fd\u6709\u4e00\u500b ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"operator"})})," \u8207\u4e00\u500b\u76f8\u5c0d\u61c9\u7684 ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"\u5167\u5efa\u51fd\u6578"})})," \u53ef\u4f7f\u7528\uff0c\u4f46\u6703\u4e0b\u9762\u9019\u5169\u500b\u5df2\u7d93\u53ef\u4ee5\u5927\u6bba\u56db\u65b9\u4e86\u3002"]}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsxs)(e.a,{href:"./Postgresql_find_value_by_Attr_of_JSONB_column",children:[(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"->>"})}),"  operator: \u67e5\u8a62\u5167\u5bb9"]})}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_set()"})})," \u51fd\u6578: ",(0,t.jsx)(e.a,{href:"./PostgreSQL_Update_JSONB_Column",children:"\u65b0\u589e"}),"\u3001",(0,t.jsx)(e.a,{href:"./PostgreSQL_Update_JSONB_Column",children:"\u4fee\u6539"}),"\u3001\u8207 ",(0,t.jsx)(e.a,{href:"./PostgreSQL_Delete_attr",children:"\u522a\u9664"})," \u842c\u7528\uff0c\u4e14\u591a\u7248\u672c\u652f\u63f4"]}),"\n",(0,t.jsx)(e.li,{children:"\u5176\u4ed6\u7684\u5c31\u5148\u7576\u4f5c\u662f PostgreSQL \u63d0\u4f9b\u7684\u8a9e\u6cd5\u7cd6\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"jsonb-column-\u5fc5\u5b78\u5167\u5bb9\u64cd\u4f5c",children:(0,t.jsx)("span",{style:{color:"#FF1100"},children:(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"Jsonb column \u5fc5\u5b78\u5167\u5bb9\u64cd\u4f5c"})})})}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"CRUD"}),(0,t.jsx)(e.th,{style:{textAlign:"center"},children:"\u64cd\u4f5c"}),(0,t.jsx)(e.th,{children:"\u7bc4\u4f8b"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"insert"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_set()"})})}),(0,t.jsxs)(e.td,{children:["update table SET jasonb_col = ",(0,t.jsx)("br",{}),"jsonb_set( jasonb_col, Array['path_element'], '{  \"k1\": \"v1\"'}'::jsonb );"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"update"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_set()"})})}),(0,t.jsx)(e.td,{children:"\u540c\u4e0a\u7bc4\u4f8b"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"delete"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_set()"})})}),(0,t.jsxs)(e.td,{children:["\u540c\u4e0a\u7bc4\u4f8b\u4f46 value \u6539\u70ba null, ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"'null'::jsonb"})})," ",(0,t.jsx)("br",{}),"update table SET jasonb_col = ",(0,t.jsx)("br",{}),"jsonb_set( jasonb_col, Array['path_element'], 'null'::jsonb );"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"select"})}),(0,t.jsx)(e.td,{style:{textAlign:"center"},children:(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"->>"})})}),(0,t.jsx)(e.td,{children:"select jasonb_col ->> 'attribute' from table"})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"postgresql-jsonb-\u96dc\u9805\u7d00\u9304",children:"PostgreSQL Jsonb \u96dc\u9805\u7d00\u9304"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u7bc4\u4f8b\u60c5\u5883"}),"\n"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u5047\u8a2d\u6709\u4e00\u500b\u7d00\u9304\u6a19\u672c\u8cc7\u8a0a table \uff0c\u5176\u4e2d\u4ee5 json_data \u7528\u4f86\u8a18\u9304\u5206\u985e\u6a39\u8cc7\u6599 (\u754c\u9580\u7db1\u76ee\u79d1\u5c6c\u7a2e)\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'    --table: insect_specimen\r\n    create table insect_specimen (\r\n      id serial primary key, \r\n      sample_id text, \r\n      collect_date timestamp without time zone, \r\n      commom_name character varying(100),\r\n      classification jsonb -- \u6e2c\u8a66\u7528\u7684 jsonb column  \r\n    );\r\n    \r\n    INSERT INTO public.insect_specimen(\r\n                id, sample_id, collect_date, commom_name, classification)\r\n        VALUES (nextVal(\'insect_specimen_id_seq\'), \'A0000000001\', \'2025-11-20\', \'\u87d1\u8782\',\r\n                \'{"Kingdom" : "Animalia", "Phylum" : "Arthropoda", "Class" : "Insecta","Superorder" : "Dictyoptera","Order" : "Blattodea"}\');\r\n                \r\n    \r\n    INSERT INTO public.insect_specimen(\r\n                id, sample_id, collect_date, commom_name, classification)\r\n        VALUES (nextVal(\'insect_specimen_id_seq\'), \'A0000000002\', \'2025-11-22\', \'\u767d\u7dda\u6591\u868a\',\r\n                \'{"Kingdom" : "Animalia","Phylum" : "Arthropoda","Class" : "Insecta","Order" : "Diptera","Family" : "Culicidae" }\');  \r\n    -- "Genus" : "Aedes"\r\n    -- "Subgenus": "Stegomyia"\r\n    -- "Species\' : "albopictus"\n'})}),"\n",(0,t.jsx)(e.h2,{id:"\u95dc\u65bc-append-\u65b0\u503c",children:"\u95dc\u65bc append \u65b0\u503c"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["JSONB column \u8981\u5148\u6709 ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"\u7a7a JSON \u7269\u4ef6"})}),",\u5982 '{ \xa0}'  \u624d\u80fd set \u503c","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u82e5\u5546\u696d\u908f\u8f2f\u4e0a jsonb \u6b04\u4f4d\u975e\u521d\u59cb\u4fbf\u6709\u8cc7\u6599\u5247\u53ef\u5148\u7d66\u4e88\u7a7a\u503c ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"'{ \xa0}'"})})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"    INSERT INTO public.insect_specimen(\r\n                id, sample_id, collect_date, commom_name, \r\n                classification)\r\n        VALUES (nextVal('insect_specimen_id_seq'), 'A0000000001', '2025-11-20', '\u87d1\u8782',\r\n                '{}');\n"})}),"\n",(0,t.jsxs)(e.h2,{id:"\u81ea\u52d5\u7e2e\u6392-jsonb-\u67e5\u8a62\u7d50\u679c-jsonb_pretty",children:["\u81ea\u52d5\u7e2e\u6392 Jsonb \u67e5\u8a62\u7d50\u679c ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_pretty"})})]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4ee5 ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_pretty(jsonb)"})})," \u9032\u884c\u81ea\u52d5\u7e2e\u6392\uff0c\u65b9\u4fbf ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"\u4eba\u5de5\u95b1\u8b80"})})]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'    select jsonb_pretty(insect.classification) classification from insect_specimen insect where id = 1;\r\n    \r\n    ==== \u67e5\u8a62\u7d50\u679c\u662f\u7121\u5e8f\u7684\r\n    "{\r\n        "Class": "Insecta",\r\n        "Order": "Blattodea",\r\n        "Phylum": "Arthropoda",\r\n        "Kingdom": "Animalia",\r\n        "Superorder": "Dictyoptera"\r\n    }"    \n'})}),"\n",(0,t.jsxs)(e.h2,{id:"\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599-insertupdate-jsonb_set",children:["\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599 insert/update: ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_set"})})]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["PostgreSQL 10+ \u53ef\u4f7f\u7528 ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"jsonb_insert"})})," : \u63d2\u5165\u65b0\u503c\uff0c\u4e0d\u8986\u84cb\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:["\u7f6e\u5165\u4e26\u53d6\u4ee3\u7269\u4ef6, Replacement(\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599)","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["arguments","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"1st: jsob \u6b04\u4f4d"}),"\n",(0,t.jsxs)(e.li,{children:["2nd: Array Path \u8def\u5f91, ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"Array['hierarchy', 'nested']"})}),"\u3002 ",(0,t.jsxs)("span",{style:{color:"#0044FF"},children:[" ",(0,t.jsx)(e.strong,{children:"\u627e\u5f97\u5230\u8def\u5f91\u624d\u6703 update"})," "]})]}),"\n",(0,t.jsxs)(e.li,{children:["3rd: Jsonb Content \u65b0\u5167\u5bb9\uff0c",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"\u9700\u8f49\u6210 jsonb"})})," \u683c\u5f0f\u3002quote \u7528\u4f86\u544a\u77e5\u662f String, ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"::jsonb"})})," \u7528\u4f86\u544a\u77e5\u8f49\u6210 jsonb \u683c\u5f0f"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Syntax: jsonb_set"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"    jsonb_set(\r\n          target JSONB, path TEXT[], new_value JSONB[, create_if_missing BOOLEAN]\r\n        ) -> JSONB\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u6ce8\u610f\u4e8b\u9805:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Array Path :","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u8a9e\u6cd5: ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"Array['hierarchy', 'nested']"})})]}),"\n",(0,t.jsx)(e.li,{children:"\u82e5 Path \u67e5\u7121\u6a19\u7684 element\uff0c\u5247\u4e0d\u52d5\u4f5c\u3002\u4f46\u6703\u6709\u6210\u529f\u56de\u61c9\u3002"}),"\n",(0,t.jsx)(e.li,{children:"element \u4e0b\u5168\u90e8\u7d50\u69cb\uff0c\u90fd\u6703\u88ab\u65b0\u503c (\u65b0 Jsonb Content \u53d6\u4ee3)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["Jsonb Content :","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u683c\u5f0f\u9808\u70ba Jsonb format\uff0c\u5167\u5bb9\u5f8c\u65b9\u9700\u52a0 ",(0,t.jsx)("code",{children:(0,t.jsx)(e.strong,{children:"::jsonb"})})," \u5ba3\u544a\u3002"]}),"\n",(0,t.jsxs)(e.li,{children:["Jsonb ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"String format"})}),' content \u8868\u793a\u6cd5: "new_value"::jsonb']}),"\n",(0,t.jsxs)(e.li,{children:["Jsonb ",(0,t.jsx)(e.em,{children:(0,t.jsx)(e.strong,{children:"Object format"})}),' content \u8868\u793a\u6cd5: " \'{  "key1": "value1", "key2": { "key2-2": "value2-2" } }\'::jsonb']}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u7bc4\u4f8b"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:'    -- \u6307\u5b9a\u8def\u5f91\u5167\u5bb9\u6539\u70ba\u7c21\u55ae\u5b57\u4e32 : String\r\n    update insect_specimen \r\n        SET classification = jsonb_set( classification, Array[\'Genus\'], \'"Aedes"\'::jsonb ) where id = 2; \r\n\r\n    -- \u6307\u5b9a\u8def\u5f91\u5167\u5bb9\u6539\u70ba nested ccontent: Json object\r\n    update insect_specimen SET classification = jsonb_set( \r\n        classification, \r\n        Array[\'Genus\'], \r\n        \'{  "name":"Aedes", \r\n            "Subgenus": { "name": "Stegomyia" }\r\n         }\'::jsonb \r\n        \r\n        ) where id = 2; \r\n        \r\n    -- \u6307\u5b9a nested \u8def\u5f91: Array[\'parent\', \'child\', \'descendent\'] \r\n    update insect_specimen \r\n        SET classification = \r\n            jsonb_set( \r\n              classification, \r\n              Array[\'Genus\', \'Subgenus\', \'name\'], \r\n              \'{ "value": "Stegomyia"}\'::jsonb ) \r\n        where id = 2;  \r\n        \r\n    ====\r\n    "{\r\n        "Class": "Insecta",\r\n        "Genus": {\r\n            "name": "Aedes",\r\n            "Subgenus": {\r\n                "name": "Stegomyia"\r\n            }\r\n        },\r\n        "Order": "Diptera",\r\n        "Family": "Culicidae",\r\n        "Phylum": "Arthropoda",\r\n        "Kingdom": "Animalia",\r\n        "Species": "albopictus"\r\n    }"        \r\n        \n'})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"\u8b8a\u9ad4: \u8def\u5f91\u76f4\u63a5\u7528 object \u4ee3\u66ff"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Array Path \u4ee5\u7269\u4ef6\u8f49\u63db"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"syntax"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- \u4e0b\u5217\u5169\u7a2e \u8def\u5f91\u5beb\u6cd5\u610f\u601d\u76f8\u540c\r\n    Array['parent', 'child', 'descendent'] \r\n    \r\n    '{parent, child, descendent}'\n"})}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"example"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"   -- \u55ae\u4e00\u968e\u5c64\r\n    update insect_specimen \r\n        SET classification = jsonb_set( classification, \r\n        '{Genus}', -- \u7b49\u540c\u65bc Array['Genus']\r\n        '\"Aedes-2\"'::jsonb ) where id = 2; \r\n\r\n   -- \u4e09\u968e\u968e\u5c64\r\n    update insect_specimen \r\n         SET classification = jsonb_set( classification, \r\n         '{Genus, Subgenus, name}', -- \u7b49\u540c\u65bc Array['Genus', 'Subgenus', 'name']\r\n         '{ \"value\": \"Stegomyia-2\" }'::jsonb ) where id = 2;  \n"})})]})}function j(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(a,{...n})}):a(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>c});var r=s(96540);const t={},i=r.createContext(t);function l(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);