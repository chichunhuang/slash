"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[7543],{28453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>d});var o=n(96540);const s={},l=o.createContext(s);function t(e){const r=o.useContext(l);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(l.Provider,{value:r},e.children)}},75448:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>d,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"Log4j/Log4j2","title":"Log4j2 \u5b78\u7fd2\u7d00\u9304","description":"Log4j2","source":"@site/docs/18_Log4j/02_Log4j2.md","sourceDirName":"18_Log4j","slug":"/Log4j/Log4j2","permalink":"/docs/Log4j/Log4j2","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Log4j2 \u5b78\u7fd2\u7d00\u9304","description":"Log4j2","keywords":["Log4j2"]},"sidebar":"totem_sidebar","previous":{"title":"Log4j \u5b78\u7fd2\u7d00\u9304","permalink":"/docs/Log4j/Log4j_Basic"},"next":{"title":"Log4j \u4ee5 Email \u9032\u884c log","permalink":"/docs/Log4j/Log4j_Mail_Appender"}}');var s=n(74848),l=n(28453);const t={title:"Log4j2 \u5b78\u7fd2\u7d00\u9304",description:"Log4j2",keywords:["Log4j2"]},d=void 0,i={},c=[{value:"log4j 2.x \u76f8\u95dc\u8a2d\u5b9a\u65b9\u5f0f",id:"log4j-2x-\u76f8\u95dc\u8a2d\u5b9a\u65b9\u5f0f",level:2},{value:"Log4j \u8207 log4j2 \u4e3b\u8981\u5dee\u7570",id:"log4j-\u8207-log4j2-\u4e3b\u8981\u5dee\u7570",level:2}];function a(e){const r={a:"a",br:"br",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:["\u9019\u908a\u6539\u7528 log4j 2.x \u7248",(0,s.jsx)(r.br,{}),"\n","\u76f8\u540c\u60c5\u5883\u6539\u7528 2.x \u7248\u8a9e\u6cd5\u8a2d\u5b9a"]}),"\n",(0,s.jsx)(r.h2,{id:"log4j-2x-\u76f8\u95dc\u8a2d\u5b9a\u65b9\u5f0f",children:"log4j 2.x \u76f8\u95dc\u8a2d\u5b9a\u65b9\u5f0f"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["\u60c5\u5883\u8acb\u53c3\u8003 ",(0,s.jsx)(r.a,{href:"./Log4j_Basic#log4j_java_configuration",children:"Log4j 1.x \u5b78\u7fd2\u7d00\u9304"})]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"\u8a2d\u5b9a\u7bc4\u4f8b:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"package insect.totem.school.School;"}),"\n",(0,s.jsx)(r.li,{children:"package insect.totem.school.classroom.ClassRoom;"}),"\n",(0,s.jsx)(r.li,{children:"Root Logger \u8cc7\u6599\u8f38\u51fa\u5230 console"}),"\n",(0,s.jsx)(r.li,{children:"School \u7684\u8cc7\u6599\u53ea\u8f38\u51fa\u5230 file"}),"\n",(0,s.jsx)(r.li,{children:"ClassRoom  \u7684\u8cc7\u6599\u53ea\u8f38\u51fa\u5230 email"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.em,{children:(0,s.jsx)(r.strong,{children:"log4j2.xml"})})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xml",children:'    <?xml version="1.0" encoding="UTF-8"?>\r\n    <Configuration status="WARN">\r\n      <Appenders>\r\n    \r\n        \x3c!-- Console Appender --\x3e\r\n        <Console name="Console" target="SYSTEM_OUT">\r\n          <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} [%t] %-5p %c - %m%n"/>\r\n        </Console>\r\n    \r\n        \x3c!-- File Appender for School --\x3e\r\n        <RollingFile name="SchoolFile" fileName="logs/school.log"\r\n                     filePattern="logs/school-%d{yyyy-MM-dd}-%i.log.gz">\r\n          <PatternLayout>\r\n            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%t] %-5p %c - %m%n</pattern>\r\n          </PatternLayout>\r\n          <Policies>\r\n            <SizeBasedTriggeringPolicy size="1MB"/>\r\n          </Policies>\r\n          <DefaultRolloverStrategy max="3"/>\r\n        </RollingFile>\r\n    \r\n        \x3c!-- SMTP Appender for ClassRoom --\x3e\r\n        <SMTP name="MailAppender"\r\n              subject="Log4j2 Error in ClassRoom"\r\n              to="admin@example.com"\r\n              from="your_email@example.com"\r\n              smtpHost="smtp.example.com"\r\n              smtpUsername="your_email@example.com"\r\n              smtpPassword="your_password"\r\n              bufferSize="512"\r\n              smtpProtocol="smtp"\r\n              smtpPort="25">\r\n          <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} [%t] %-5p %c - %m%n"/>\r\n        </SMTP>\r\n    \r\n      </Appenders>\r\n    \r\n      <Loggers>\r\n    \r\n        \x3c!-- Logger for School --\x3e\r\n        <Logger name="insect.totem.school.School" level="debug" additivity="false">\r\n          <AppenderRef ref="SchoolFile"/>\r\n        </Logger>\r\n    \r\n        \x3c!-- Logger for ClassRoom --\x3e\r\n        <Logger name="insect.totem.school.classroom.ClassRoom" level="error" additivity="false">\r\n          <AppenderRef ref="MailAppender"/>\r\n        </Logger>\r\n    \r\n        \x3c!-- Root Logger --\x3e\r\n        <Root level="info">\r\n          <AppenderRef ref="Console"/>\r\n        </Root>\r\n    \r\n      </Loggers>\r\n    </Configuration>\n'})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.em,{children:(0,s.jsx)(r.strong,{children:"log4j2.properties"})})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-properties",children:"    status = WARN\r\n    name = PropertiesConfig\r\n    \r\n    # ===== Appenders =====\r\n    \r\n    appender.console.type = Console\r\n    appender.console.name = Console\r\n    appender.console.layout.type = PatternLayout\r\n    appender.console.layout.pattern = %d{yyyy-MM-dd HH:mm:ss} [%t] %-5p %c - %m%n\r\n    \r\n    appender.school.type = RollingFile\r\n    appender.school.name = SchoolFile\r\n    appender.school.fileName = logs/school.log\r\n    appender.school.filePattern = logs/school-%d{yyyy-MM-dd}-%i.log.gz\r\n    appender.school.layout.type = PatternLayout\r\n    appender.school.layout.pattern = %d{yyyy-MM-dd HH:mm:ss} [%t] %-5p %c - %m%n\r\n    appender.school.policies.type = Policies\r\n    appender.school.policies.size.type = SizeBasedTriggeringPolicy\r\n    appender.school.policies.size.size = 1MB\r\n    appender.school.strategy.type = DefaultRolloverStrategy\r\n    appender.school.strategy.max = 3\r\n    \r\n    appender.mail.type = SMTP\r\n    appender.mail.name = MailAppender\r\n    appender.mail.subject = Log4j2 Error in ClassRoom\r\n    appender.mail.to = admin@example.com\r\n    appender.mail.from = your_email@example.com\r\n    appender.mail.smtpHost = smtp.example.com\r\n    appender.mail.smtpPort = 25\r\n    appender.mail.smtpProtocol = smtp\r\n    appender.mail.smtpUsername = your_email@example.com\r\n    appender.mail.smtpPassword = your_password\r\n    appender.mail.bufferSize = 512\r\n    appender.mail.layout.type = PatternLayout\r\n    appender.mail.layout.pattern = %d{yyyy-MM-dd HH:mm:ss} [%t] %-5p %c - %m%n\r\n    \r\n    # ===== Loggers =====\r\n    \r\n    logger.school.name = insect.totem.school.School\r\n    logger.school.level = debug\r\n    logger.school.additivity = false\r\n    logger.school.appenderRefs = school\r\n    logger.school.appenderRef.school.ref = SchoolFile\r\n    \r\n    logger.classroom.name = insect.totem.school.classroom.ClassRoom\r\n    logger.classroom.level = error\r\n    logger.classroom.additivity = false\r\n    logger.classroom.appenderRefs = mail\r\n    logger.classroom.appenderRef.mail.ref = MailAppender\r\n    \r\n    # ===== Root Logger =====\r\n    \r\n    rootLogger.level = info\r\n    rootLogger.appenderRefs = console\r\n    rootLogger.appenderRef.console.ref = Console\r\n\n"})}),"\n",(0,s.jsx)(r.h2,{id:"log4j-\u8207-log4j2-\u4e3b\u8981\u5dee\u7570",children:"Log4j \u8207 log4j2 \u4e3b\u8981\u5dee\u7570"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u9019\u908a\u6574\u7406\u7db2\u8def\u4e0a Log4j \u8207 log4j2 \u9593\u4e3b\u8981\u5dee\u7570"}),"\n"]}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:(0,s.jsx)(r.strong,{children:"\u5206\u985e"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.strong,{children:"Log4j 1.x"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.strong,{children:"Log4j 2.x"})}),(0,s.jsx)(r.th,{children:(0,s.jsx)(r.strong,{children:"\u5dee\u7570\u8207\u8aaa\u660e"})})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u6548\u80fd\u6838\u5fc3"})}),(0,s.jsx)(r.td,{children:"\u540c\u6b65 logging"}),(0,s.jsxs)(r.td,{children:["\u4f7f\u7528 ",(0,s.jsx)(r.a,{href:"https://lmax-exchange.github.io/disruptor/",children:"LMAX Disruptor"})," \u9ad8\u6548\u975e\u540c\u6b65\u6838\u5fc3"]}),(0,s.jsx)(r.td,{children:"Log4j 2 \u7684 AsyncAppender \u9810\u8a2d\u652f\u63f4\u975e\u540c\u6b65\uff0c\u591a\u57f7\u884c\u7dd2\u4e0b\u6027\u80fd\u986f\u8457\u63d0\u5347"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u67b6\u69cb"})}),(0,s.jsx)(r.td,{children:"\u7269\u4ef6\u5c0e\u5411\u4f46\u55ae\u4e00\u985e\u578b\u64f4\u5c55"}),(0,s.jsxs)(r.td,{children:["Plugin \u67b6\u69cb\uff0c\u6a21\u7d44\u5316\u8a2d\u8a08",(0,s.jsx)("br",{}),"(Appender/Filter/Layout \u53ef\u63d2\u62d4)"]}),(0,s.jsxs)(r.td,{children:["\u4f7f\u7528 ",(0,s.jsx)(r.code,{children:"@Plugin"})," \u8a3b\u89e3\u5373\u53ef\u64f4\u5145\u81ea\u8a02\u7d44\u4ef6"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u8a2d\u5b9a\u6a94\u652f\u63f4"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:".properties"})," / ",(0,s.jsx)(r.code,{children:".xml"})]}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:".properties"})," / ",(0,s.jsx)(r.code,{children:".xml"})," / ",(0,s.jsx)(r.code,{children:".json"})," / ",(0,s.jsx)(r.code,{children:".yaml"})]}),(0,s.jsx)(r.td,{children:"\u66f4\u5f48\u6027\uff0c\u652f\u63f4 JSON/YAML\uff0c\u4e14\u652f\u63f4\u71b1\u8f09\u5165"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u57f7\u884c\u7dd2"})}),(0,s.jsx)(r.td,{children:"MDC / NDC"}),(0,s.jsx)(r.td,{children:"ThreadContext(Map / Stack)"}),(0,s.jsxs)(r.td,{children:["\u652f\u63f4 Map \u8207 Stack(\u6bd4 MDC/NDC \u66f4\u5f48\u6027)\uff0c",(0,s.jsx)("br",{}),"\u53ef\u8de8\u57f7\u884c\u7dd2\u50b3\u905e context"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u904e\u6ffe\u6a5f\u5236"})}),(0,s.jsx)(r.td,{children:"\u50c5 Logger \u8a2d\u7b49\u7d1a"}),(0,s.jsx)(r.td,{children:"Logger\u3001Appender\u3001Marker\u3001ThreadContext \u7686\u53ef\u904e\u6ffe"}),(0,s.jsxs)(r.td,{children:["\u652f\u63f4\u8907\u96dc\u689d\u4ef6\u7d44\u5408\u8207\u904e\u6ffe\u5668",(0,s.jsx)("br",{}),"(\u5982 RegexFilter\u3001ScriptFilter)"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u975e\u540c\u6b65"})}),(0,s.jsx)(r.td,{children:"\u9700\u4f7f\u7528 AsyncAppender"}),(0,s.jsx)(r.td,{children:"\u539f\u751f\u652f\u63f4 Disruptor-based AsyncLoggers(\u6548\u80fd\u6700\u4f73)"}),(0,s.jsxs)(r.td,{children:["\u5728\u5927\u6d41\u91cf log \u5834\u666f(\u5982\u91d1\u878d\u3001\u7269\u806f\u7db2)",(0,s.jsx)("br",{}),"\u53ef\u660e\u986f\u964d\u4f4e\u5ef6\u9072"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u5ef6\u9072\u8655\u7406"})}),(0,s.jsx)(r.td,{children:"\u4e0d\u652f\u63f4"}),(0,s.jsx)(r.td,{children:"\u652f\u63f4 lambda \u5ef6\u9072 log \u8a55\u4f30"}),(0,s.jsxs)(r.td,{children:["\u5982 ",(0,s.jsx)(r.code,{children:'logger.debug(() -> "expensive msg")'}),"\uff0c\u4e0d\u57f7\u884c\u7121\u610f\u7fa9\u5efa\u69cb"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u8a2d\u5b9a\u91cd\u8f09"})}),(0,s.jsx)(r.td,{children:"\u624b\u52d5\u91cd\u555f"}),(0,s.jsx)(r.td,{children:"\u652f\u63f4\u81ea\u52d5\u5075\u6e2c\u8a2d\u5b9a\u6a94\u8b8a\u66f4\u4e26\u91cd\u65b0\u8f09\u5165"}),(0,s.jsx)(r.td,{children:"\u589e\u52a0\u5f48\u6027\u8207\u904b\u7dad\u4fbf\u5229\u6027"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"\u5b89\u5168\u6f0f\u6d1e"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.a,{href:"https://logging.apache.org/log4j/2.x/security.html",children:"\u91cd\u5927\u6f0f\u6d1e"}),(0,s.jsx)("br",{}),"\u5982 Log4Shell"]}),(0,s.jsx)(r.td,{children:"Log4j 2.16+ \u4fee\u5fa9\u6f0f\u6d1e\u4e26\u6539\u826f JNDI \u884c\u70ba"}),(0,s.jsx)(r.td,{})]})]})]})]})}function p(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);