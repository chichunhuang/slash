"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[2498],{23319:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>g,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"PostgreSQL/PostgreSQL_Query_Log","title":"PostgreSQL SQL \u65e5\u8a8c\u7d00\u9304","description":"PostgreSQL Query Log","source":"@site/docs/140_PostgreSQL/PostgreSQL_Query_Log.md","sourceDirName":"140_PostgreSQL","slug":"/PostgreSQL/PostgreSQL_Query_Log","permalink":"/docs/PostgreSQL/PostgreSQL_Query_Log","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"PostgreSQL SQL \u65e5\u8a8c\u7d00\u9304","description":"PostgreSQL Query Log","keywords":["postgresql","Query Log"]},"sidebar":"totem_sidebar","previous":{"title":"PostgreSQL FDW Setting","permalink":"/docs/PostgreSQL/PostgreSQL_FDW_Setting"},"next":{"title":"PostgreSQL string_agg Function","permalink":"/docs/PostgreSQL/PostgreSQL_string_agg_function"}}');var t=n(74848),s=n(28453);const l={title:"PostgreSQL SQL \u65e5\u8a8c\u7d00\u9304",description:"PostgreSQL Query Log",keywords:["postgresql","Query Log"]},i=void 0,g={},c=[{value:"\u958b\u555f PostgreSQL SQL \u57f7\u884c\u7d00\u9304",id:"\u958b\u555f-postgresql-sql-\u57f7\u884c\u7d00\u9304",level:2},{value:"\u958b\u555f logging_collector",id:"\u958b\u555f-logging_collector",level:2},{value:"\u6307\u5b9a\u8981\u76e3\u8996\u7684\u6307\u4ee4\u7a2e\u985e",id:"\u6307\u5b9a\u8981\u76e3\u8996\u7684\u6307\u4ee4\u7a2e\u985e",level:2},{value:"\u6307\u5b9a log \u8f38\u51fa\u4f4d\u7f6e",id:"\u6307\u5b9a-log-\u8f38\u51fa\u4f4d\u7f6e",level:2},{value:"\u6307\u5b9a log \u8f38\u51fa\u6a94\u6848\u540d\u7a31",id:"\u6307\u5b9a-log-\u8f38\u51fa\u6a94\u6848\u540d\u7a31",level:2},{value:"\u5176\u4ed6\u95dc\u65bc log rotation \u76f8\u95dc\u8a2d\u5b9a",id:"\u5176\u4ed6\u95dc\u65bc-log-rotation-\u76f8\u95dc\u8a2d\u5b9a",level:2},{value:"\u66f4\u6539\u8a2d\u5b9a\u5f8c\u9808\u91cd\u555f\u8cc7\u6599\u5eab",id:"\u66f4\u6539\u8a2d\u5b9a\u5f8c\u9808\u91cd\u555f\u8cc7\u6599\u5eab",level:2},{value:"\u65e5\u8a8c\u67e5\u770b\u7bc4\u4f8b\u6307\u4ee4",id:"\u65e5\u8a8c\u67e5\u770b\u7bc4\u4f8b\u6307\u4ee4",level:2}];function a(e){const r={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"\u958b\u555f-postgresql-sql-\u57f7\u884c\u7d00\u9304",children:"\u958b\u555f PostgreSQL SQL \u57f7\u884c\u7d00\u9304"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:["PostgreSQL \u9810\u8a2d\u53ea\u6703\u7d00\u9304 Error Logs\uff0c\u642d\u914d\u8cc7\u5b89\u8a8d\u8b49\u6642\u53ef\u80fd\u6703\u60f3\u77e5\u9053\u6709\u54ea\u4e9b\u8cc7\u6599\u88ab\u67e5\u8a62\u904e\u3002",(0,t.jsx)("br",{}),"\r\n\u4e0b\u9762\u65b9\u5f0f\u8a18\u9304\u555f\u52d5\u8cc7\u6599\u5eab\u57f7\u884c\u7d00\u9304\u65e5\u8a8c\u529f\u80fd\u65b9\u5f0f\u3002  ",(0,t.jsx)("br",{}),"\r\n\u8abf\u6574\u524d\u8a18\u5f97\u5148\u505c\u6a5f\u5099\u4efd postgresql.conf \u6a94"]}),"\n"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://github.com/postgres/postgres/blob/master/src/backend/utils/misc/postgresql.conf.sample",children:"postgresql.conf \u5b8c\u6574\u7bc4\u4f8b"})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"\u958b\u555f-logging_collector",children:"\u958b\u555f logging_collector"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\u9700\u7de8\u8f2f postgresql.conf \u6a94\uff0c\u53ef\u80fd\u6240\u5728\u4f4d\u7f6e","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"windows :\\Program\\Files\\PostgreSQL<version>\\data\\postgresql.conf"}),"\n",(0,t.jsx)(r.li,{children:"linux: /var/lib/postgresql/data/postgresql.conf"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-properties",children:"\r\n# This is used when logging to stderr:\r\n\r\nlogging_collector = on        \r\n\r\n                    # Enable capturing of stderr and csvlog\r\n                    # into log files. Required to be on for csvlogs.\r\n                    # (change requires restart)\n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u6307\u5b9a\u8981\u76e3\u8996\u7684\u6307\u4ee4\u7a2e\u985e",children:"\u6307\u5b9a\u8981\u76e3\u8996\u7684\u6307\u4ee4\u7a2e\u985e"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-properties",children:"\r\nlog_statement = 'all' \r\n                    # none, ddl, mod, all\r\n                    \n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u6307\u5b9a-log-\u8f38\u51fa\u4f4d\u7f6e",children:"\u6307\u5b9a log \u8f38\u51fa\u4f4d\u7f6e"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-properties",children:"\r\nlog_directory = 'log'\r\n            \r\n                    # directory where log files are written,\r\n                    # can be absolute or relative to PGDATA\n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u6307\u5b9a-log-\u8f38\u51fa\u6a94\u6848\u540d\u7a31",children:"\u6307\u5b9a log \u8f38\u51fa\u6a94\u6848\u540d\u7a31"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-properties",children:"\r\nlog_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'    \r\n                    # log file name pattern,\r\n                    # can include strftime() escapes\r\n                    \n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u5176\u4ed6\u95dc\u65bc-log-rotation-\u76f8\u95dc\u8a2d\u5b9a",children:"\u5176\u4ed6\u95dc\u65bc log rotation \u76f8\u95dc\u8a2d\u5b9a"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-properties",children:"\r\nlog_duration = on \r\n                 # Logs the duration of each completed SQL statement\r\n                 # \u8a18\u9304\u6bcf\u500b\u5b8c\u6210\u7684 SQL \u8a9e\u53e5\u7684\u6301\u7e8c\u6642\u9593\uff0c\u6beb\u79d2\r\n                 \r\nlog_min_duration_statement = 0\r\n                 # \u8d85\u904e\u6307\u5b9a\u6642\u9593\u95be\u503c\u7684 Statement \u6703\u88ab\u8a18\u9304\r\n\r\n\r\nlog_file_mode = 0600            \r\n                    # creation mode for log files,\r\n                    # begin with 0 to use octal notation\r\n                    # 0600: \u4f3a\u670d\u5668\u64c1\u6709\u8005\u53ef\u4ee5\u8b80\u53d6\u6216\u5beb\u5165\u65e5\u8a8c\u6a94\u6848\r\n                    # 0640: \u5141\u8a31\u6240\u6709\u8005\u7fa4\u7d44\u7684\u6210\u54e1\u8b80\u53d6\u6a94\u6848\r\n                    \r\n                    \r\n#log_rotation_age = 1d            \r\n                    # Automatic rotation of logfiles will\r\n                    # happen after that time.  0 disables.\r\n                    # \u4f7f\u7528\u55ae\u4e00\u65e5\u8a8c\u6a94\u6848\u7684\u6700\u9577\u6642\u9593\uff0c\u8d85\u904e\u6b64\u6642\u9593\u5f8c\u5c07\u5efa\u7acb\u65b0\u7684\u65e5\u8a8c\u6a94\u6848\u3002\r\n                    \r\n#log_rotation_size = 10MB        \r\n                    # Automatic rotation of logfiles will\r\n                    # happen after that much log output.\r\n                    # 0 disables.\r\n                    # \u55ae\u4e00\u65e5\u8a8c\u6a94\u6848\u7684\u6700\u5927\u5927\u5c0f\u3002\r\n                    \n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u66f4\u6539\u8a2d\u5b9a\u5f8c\u9808\u91cd\u555f\u8cc7\u6599\u5eab",children:"\u66f4\u6539\u8a2d\u5b9a\u5f8c\u9808\u91cd\u555f\u8cc7\u6599\u5eab"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-property",children:"\r\nsudo systemctl restart postgresql\r\n\r\nor \r\n\r\nsudo service postgresql restart\r\n\n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u65e5\u8a8c\u67e5\u770b\u7bc4\u4f8b\u6307\u4ee4",children:"\u65e5\u8a8c\u67e5\u770b\u7bc4\u4f8b\u6307\u4ee4"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"\u4f7f\u7528 grep command"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'# \u9010\u884c\u67e5\u8a62\r\nless pg_log/postgresql-2025-02-27_120000.log\r\n\r\n# \u95dc\u9375\u5b57\u67e5\u8a62\r\ngrep "SELECT" pg_log/postgresql-2025-02-27_120000.log\r\n\r\ngrep "duration" pg_log/postgresql-2025-02-27_120000.log\r\n\n'})})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>i});var o=n(96540);const t={},s=o.createContext(t);function l(e){const r=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),o.createElement(s.Provider,{value:r},e.children)}}}]);