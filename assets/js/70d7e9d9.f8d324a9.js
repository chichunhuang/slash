"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[8170],{28453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>i});var r=s(96540);const o={},t=r.createContext(o);function l(n){const e=r.useContext(t);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:l(n.components),r.createElement(t.Provider,{value:e},n.children)}},36920:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"PostgreSQL/JSONB/PostgreSQL_Contains","title":"Jsonb \u5167\u5bb9\u7684 where \u67e5\u8a62","description":"Key value \u662f\u5426\u5b58\u5728\u65bc Jsonb","source":"@site/docs/140_PostgreSQL/JSONB/050_PostgreSQL_Contains.md","sourceDirName":"140_PostgreSQL/JSONB","slug":"/PostgreSQL/JSONB/PostgreSQL_Contains","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Contains","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":50,"frontMatter":{"title":"Jsonb \u5167\u5bb9\u7684 where \u67e5\u8a62","description":"Key value \u662f\u5426\u5b58\u5728\u65bc Jsonb","keywords":["postgresql","Jsonb","condition"]},"sidebar":"totem_sidebar","previous":{"title":"\u5408\u4f75 JSONB \u8cc7\u6599","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Json_Concatenate"},"next":{"title":"functions","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Functions"}}');var o=s(74848),t=s(28453);const l={title:"Jsonb \u5167\u5bb9\u7684 where \u67e5\u8a62",description:"Key value \u662f\u5426\u5b58\u5728\u65bc Jsonb",keywords:["postgresql","Jsonb","condition"]},i=void 0,c={},d=[{value:"Jsonb k/v Pair \u70ba\u689d\u4ef6\u9032\u884c Row \u67e5\u8a62: <code>\xa0<strong>@&gt;</strong> </code>",id:"jsonb-kv-pair-\u70ba\u689d\u4ef6\u9032\u884c-row-\u67e5\u8a62--",level:2},{value:"Jsonb \u662f\u5426\u540c\u6642\u5b58\u5728\u9802\u5c64\u9375: <code>\xa0<strong>?&amp;</strong> </code>",id:"jsonb-\u662f\u5426\u540c\u6642\u5b58\u5728\u9802\u5c64\u9375--",level:2},{value:"Jsonb \u662f\u5426\u5b58\u5728\u4efb\u4e00\u9802\u5c64\u9375: <code>\xa0<strong>?|</strong> </code>",id:"jsonb-\u662f\u5426\u5b58\u5728\u4efb\u4e00\u9802\u5c64\u9375--",level:2},{value:"Jsonb \u662f\u5426\u5b58\u5728\u9802\u5c64\u9375: <code>\xa0<strong>?</strong> </code>",id:"jsonb-\u662f\u5426\u5b58\u5728\u9802\u5c64\u9375--",level:2}];function a(n){const e={blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsxs)(e.p,{children:["\u7d00\u9304\u80fd\u8207 GIN index (Generalized Inverted Index) \u76f8\u4e92\u642d\u914d\u4f7f\u7528\u7684 \u67e5\u8a62\u985e Operators\u3002",(0,o.jsx)(e.br,{}),"\n","\u9019\u5e7e\u500b operators \u4e3b\u8981 ",(0,o.jsx)("code",{children:(0,o.jsx)(e.strong,{children:"\u7528\u5728 WHERE \u5b50\u53e5"})})," \u4e2d\uff0c\u56de\u50b3\u7d50\u679c\u90fd\u662f boolean\u3002",(0,o.jsx)(e.br,{}),"\n","\u5728 index \u642d\u914d\u4e0b\u80fd\u9054\u5230\u66f4\u9ad8\u7684\u67e5\u8a62\u6548\u7387\u3002"]}),"\n"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["\u8a5e\u5f59\u8a3b\u89e3:","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)("span",{style:{backgroundColor:"yellow"},children:"\u9802\u5c64\u9375(top-level key)"}),": ",(0,o.jsxs)("span",{style:{color:"#0044FF"},children:[" ",(0,o.jsx)(e.strong,{children:"\u6307\u7684\u662f Json \u7269\u4ef6\u4e2d\u672a\u69fd\u4e32 (nested) \u7684\u5c6c\u6027\u9375\u503c\u3002\u4e5f\u5c31\u662f\u7b2c\u4e00\u5c64\u7684 keys"})," "]}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["Jsonb \u67e5\u8a62\u985e Operators: ",(0,o.jsxs)("span",{style:{color:"#0044FF"},children:[" ",(0,o.jsx)(e.strong,{children:"\u53ef\u4ee5\u60f3\u6210\u662f Jsonb \u4e2d\u7684 where conditions"})," "]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"@>"})," "]}),": \u5de6\u5074 Jsonb (\u8cc7\u6599)\u662f\u5426\u5305\u542b\u53f3\u5074 Jsonb (\u689d\u4ef6)\u5167\u5bb9\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?|"})," "]}),": Jsonb Object \u662f\u5426\u5305\u542b\u6307\u5b9a\u7684 \u4efb\u4e00 keys (String Array)\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?&"})," "]}),": Jsonb Object \u662f\u5426\u5305\u542b\u6307\u5b9a\u7684 \u5168\u90e8 keys (String Array)\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)("span",{style:{color:"#996633"},children:(0,o.jsx)(e.em,{children:(0,o.jsx)(e.strong,{children:"?"})})})," : Jsonb Object \u662f\u5426\u5305\u542b\u6307\u5b9a\u7684 key (\u55ae\u4e00\u689d\u4ef6, String)\u3002\u76f4\u63a5\u4f7f\u7528 ",(0,o.jsx)("code",{children:(0,o.jsx)(e.strong,{children:"?&"})})," \u66ff\u4ee3\u5373\u53ef\u3002"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)("span",{style:{color:"#996633"},children:(0,o.jsx)(e.em,{children:(0,o.jsx)(e.strong,{children:"<@"})})})," : \u53f3\u5074 Jsonb (\u689d\u4ef6)\u662f\u5426\u5305\u542b\u5de6\u5074 Jsonb (\u8cc7\u6599)\u5167\u5bb9\u3002\u8207 ",(0,o.jsx)("code",{children:(0,o.jsx)(e.strong,{children:"@>"})})," \u5dee\u7570\u53ea\u662f\u689d\u4ef6\u5de6\u53f3\u5c0d\u8abf\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.em,{children:(0,o.jsx)(e.strong,{children:"Jsonb Where extensions"})})}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"operator"}),(0,o.jsx)(e.th,{children:"\u689d\u4ef6\u53c3\u6578 (\u53f3\u5f0f)"}),(0,o.jsx)(e.th,{children:"\u8aaa\u660e"}),(0,o.jsx)(e.th,{children:"\u4f7f\u7528\u60c5\u5883"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"@>"})}),(0,o.jsxs)(e.td,{children:["Json Object ",(0,o.jsx)("br",{}),"key-value pair ",(0,o.jsx)("br",{}),' \'{"k1": "v1", "k2": "v2"}\'']}),(0,o.jsx)(e.td,{children:"\u53f3\u5f0f\u8cc7\u6599\u662f\u5426\u5b58\u5728\u65bc\u5de6\u5f0f"}),(0,o.jsx)(e.td,{children:"Jsonb \u4e2d\u7684 where \u5b50\u53e5"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"?|"})}),(0,o.jsxs)(e.td,{children:["Text Array ",(0,o.jsx)("br",{}),"TEXT[] ",(0,o.jsx)("br",{}),' \'["k1","k2"]\'']}),(0,o.jsxs)(e.td,{children:["\u53f3\u5f0f\u9375\u503c\u662f\u5426 ",(0,o.jsx)(e.em,{children:(0,o.jsx)(e.strong,{children:"\u4efb\u4e00"})})," \u5b58\u5728\u65bc\u5de6\u5f0f\u9802\u5c64\u9375"]}),(0,o.jsx)(e.td,{children:"web form filter \u7f3a\u503c\u4e0d\u8003\u616e"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"?&"})}),(0,o.jsxs)(e.td,{children:["Text Array ",(0,o.jsx)("br",{}),"TEXT[] ",(0,o.jsx)("br",{}),' \'["k1","k2"]\'']}),(0,o.jsxs)(e.td,{children:["\u53f3\u5f0f\u9375\u503c\u662f\u5426 ",(0,o.jsx)(e.em,{children:(0,o.jsx)(e.strong,{children:"\u5168\u90e8"})})," \u5b58\u5728\u65bc\u5de6\u5f0f\u9802\u5c64\u9375"]}),(0,o.jsx)(e.td,{children:"DAO \u8003\u91cf\u50b3\u5165\u53c3\u6578\u7a7a\u503c\u6642\u5fc5\u9808\u70ba\u7a7a"})]})]})]}),"\n",(0,o.jsx)("br",{}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"\u7bc4\u4f8b\u60c5\u5883: \u56db\u652f\u624b\u6a5f\u7684\u5546\u54c1\u898f\u683c"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sql",children:'\r\n    CREATE TABLE products (\r\n        id SERIAL PRIMARY KEY,\r\n        name TEXT NOT NULL,\r\n        attributes JSONB\r\n    );\r\n    \r\n    -- \u65b0\u589e\u4e00\u4e9b\u7bc4\u4f8b\u8cc7\u6599\r\n    INSERT INTO products (name, attributes) VALUES\r\n        (\'iPhone 15 Pro\', \'{"brand": "Apple", "color": "\u5929\u7136\u9226\u91d1\u5c6c", "storage": "256GB", "features": ["A17 Pro Chip", "USB-C"], "dimensions": {"height": 146.6, "width": 70.6}}\'),\r\n        (\'Samsung Galaxy S24\', \'{"brand": "Samsung", "color": "\u7d2b\u8272", "storage": "512GB", "features": ["Galaxy AI", "Snapdragon 8 Gen 3"], "has_sd_card_slot": false}\'),\r\n        (\'Google Pixel 8\', \'{"brand": "Google", "color": "\u66dc\u77f3\u9ed1", "storage": "128GB", "features": ["Google Tensor G3", "Magic Eraser"]}\'),\r\n        (\'\u4e8c\u624b iPhone 13\', \'{"brand": "Apple", "color": "\u85cd\u8272", "storage": "256GB", "condition": "used"}\'),\r\n        (\'Sony Xperia 1 VII\', \'{"brand": "Sony",  "color": null}\'),\r\n        (\'Asus Zenfone 11 ultra\', \'{"brand": "Asus",  "storage": "512GB"}\');\n'})}),"\n",(0,o.jsxs)(e.h2,{id:"jsonb-kv-pair-\u70ba\u689d\u4ef6\u9032\u884c-row-\u67e5\u8a62--",children:["Jsonb k/v Pair \u70ba\u689d\u4ef6\u9032\u884c Row \u67e5\u8a62: ",(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"@>"})," "]})]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"@>"})," "]}),": Contains KV pair\uff0c(emoticon : look at right side)"]}),"\n",(0,o.jsx)(e.li,{children:"\u6982\u5ff5\u5c31\u662f\u7528\u5728 Jsonb \u4e2d\u7684 where \u5b50\u53e5\u3002"}),"\n",(0,o.jsx)(e.li,{children:"\u82e5\u689d\u4ef6(\u53f3\u5f0f)\u51fa\u73fe\u91cd\u8907\u7684 keys\uff0c\u610f\u5373 field \u91cd\u8907\u7d66\u4e88\u3002\u5247\u5f8c\u4ee4\u4fee\u524d\u4ee4\uff0c\u53ea\u6703\u4ee5\u8f03\u665a\u6307\u5b9a\u70ba\u6e96\u3002"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sql",children:'    -- \u67e5\u8a62 Apple 256G \u7684\u624b\u6a5f \r\n    select name, attributes\r\n        from products\r\n        where attributes @> \'{"brand": "Apple", "storage": "256GB"}\';\r\n    \r\n    --\x3e iPhone 15 Pro, \u4e8c\u624b iPhone 13    \n'})}),"\n",(0,o.jsxs)(e.h2,{id:"jsonb-\u662f\u5426\u540c\u6642\u5b58\u5728\u9802\u5c64\u9375--",children:["Jsonb \u662f\u5426\u540c\u6642\u5b58\u5728\u9802\u5c64\u9375: ",(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?&"})," "]})]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?&"})," "]}),": Contains All keys\uff0c(emoticon : exists + and)"]}),"\n",(0,o.jsx)(e.li,{children:"\u689d\u4ef6\u4ee5 String Array \u50b3\u905e"}),"\n",(0,o.jsx)(e.li,{children:"\u6982\u5ff5\u5c31\u662f\u7528\u5728 Jsonb \u4e2d\u7684 exists\u3001not exists \u5224\u65b7\u3002"}),"\n",(0,o.jsx)(e.li,{children:"\u4f7f\u7528\u60c5\u5883: Service/DAO \u53c3\u6578\uff0cnull \u4e0d\u5ffd\u7565\u3002\u3002"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sql",children:"    select name, attributes\r\n        from products   \r\n        where attributes ?& ARRAY['brand', 'color', 'storage'];\r\n        \r\n    -- \u6982\u5ff5\u540c\u4e0a\uff0c\u5728\u8003\u91cf Jsonb GIN index \u6700\u4f73\u5316\u8abf\u6574\uff0c\u5efa\u8b70\u7528 ?&\r\n    select name, attributes\r\n        from products\r\n        where attributes ? 'brand' and attributes ? 'color' and attributes ? 'storage' ;      \n"})}),"\n",(0,o.jsxs)(e.h2,{id:"jsonb-\u662f\u5426\u5b58\u5728\u4efb\u4e00\u9802\u5c64\u9375--",children:["Jsonb \u662f\u5426\u5b58\u5728\u4efb\u4e00\u9802\u5c64\u9375: ",(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?|"})," "]})]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?|"})," "]}),": Contains Any keys\uff0c(emoticon : exists + or)"]}),"\n",(0,o.jsx)(e.li,{children:"\u689d\u4ef6\u4e5f\u662f\u4ee5 String Array \u50b3\u905e"}),"\n",(0,o.jsx)(e.li,{children:"\u4f7f\u7528\u60c5\u5883: \u4e32\u63a5 Web Form \u7684\u67e5\u8a62\u689d\u4ef6\uff0cnull \u8996\u70ba\u5ffd\u7565\u3002"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sql",children:"    select name, attributes\r\n        from products   \r\n        where attributes ?| ARRAY['dimensions', 'condition'];\r\n        \r\n    -- \u6982\u5ff5\u540c\u4e0a\uff0c\u5728\u8003\u91cf Jsonb GIN index \u6700\u4f73\u5316\u8abf\u6574\uff0c\u5efa\u8b70\u7528 ?|\r\n    select name, attributes\r\n        from products\r\n        where attributes ? 'dimensions' or attributes ? 'condition' ;      \n"})}),"\n",(0,o.jsxs)(e.h2,{id:"jsonb-\u662f\u5426\u5b58\u5728\u9802\u5c64\u9375--",children:["Jsonb \u662f\u5426\u5b58\u5728\u9802\u5c64\u9375: ",(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?"})," "]})]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsxs)("code",{children:["\xa0",(0,o.jsx)(e.strong,{children:"?"})," "]}),": \u6307\u5b9a ",(0,o.jsxs)("span",{style:{color:"#0044FF"},children:[" ",(0,o.jsx)(e.strong,{children:"top-level key"})," "]})," \u662f\u5426\u5b58\u5728\u3002\u4e0d\u8003\u616e value \u72c0\u614b\u3002"]}),"\n",(0,o.jsx)(e.li,{children:"\u6982\u5ff5\u5c31\u662f\u7528\u5728 Jsonb \u4e2d\u7684 exists\u3001not exists \u5224\u65b7\u3002"}),"\n",(0,o.jsxs)(e.li,{children:["\u53ef\u7528 ",(0,o.jsx)("code",{children:(0,o.jsx)(e.strong,{children:"?&"})})," \u53d6\u4ee3: \u5224\u65b7\u540c\u6642\u5b58\u5728\u591a\u500b top-level keys\u3002"]}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sql",children:"    -- \u9010\u7b46(row) \u6aa2\u67e5\uff0c\u5c07\u6709\u6307\u5b9a key \u7684 row \u9078\u51fa\u3002\r\n    -- Sony \u6709 color key\uff0c\u4f46\u672a\u8ce6\u503c\u6703\u88ab\u9078\u51fa\u3002\r\n    select name, attributes\r\n        from products\r\n        where attributes ? 'color'; \r\n    \r\n    -- \u7b49\u540c\u65bc    \r\n    select name, attributes\r\n        from products\r\n        where attributes ->> 'color' is not  null ; \r\n    \r\n    -- \u53cd\u5411\u9078\u64c7\u9700\u52a0 Not  \r\n    select name, attributes\r\n        from products\r\n        where NOT (attributes ? 'color');\r\n    -- \u8a3b: \u6aa2\u67e5\u7684\u662f key \r\n    -- \u6240\u4ee5: Sony Xperia:  \"color\": null  \u6709 key \u6240\u4ee5\u4e0d\u6703\u88ab\u9078\u51fa      \n"})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(a,{...n})}):a(n)}}}]);