"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[7194],{28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(96540);const t={},l=s.createContext(t);function i(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(l.Provider,{value:n},e.children)}},38688:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"PostgreSQL/PostgreSQL_FDW_Setting","title":"PostgreSQL FDW DB link\u8a2d\u5b9a","description":"PostgreSQL Foreign Data Wrappers \u8a2d\u5b9a","source":"@site/docs/140_PostgreSQL/PostgreSQL_FDW_Setting.md","sourceDirName":"140_PostgreSQL","slug":"/PostgreSQL/PostgreSQL_FDW_Setting","permalink":"/docs/PostgreSQL/PostgreSQL_FDW_Setting","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"PostgreSQL FDW DB link\u8a2d\u5b9a","description":"PostgreSQL Foreign Data Wrappers \u8a2d\u5b9a","keywords":["dblink","FDW","PostgreSQL"]},"sidebar":"totem_sidebar","previous":{"title":"pgAdmin \u4f7f\u7528 dblink","permalink":"/docs/PostgreSQL/PostgreSQL_DB_link"},"next":{"title":"PostgreSQL SQL \u65e5\u8a8c\u7d00\u9304","permalink":"/docs/PostgreSQL/PostgreSQL_Query_Log"}}');var t=r(74848),l=r(28453);const i={title:"PostgreSQL FDW DB link\u8a2d\u5b9a",description:"PostgreSQL Foreign Data Wrappers \u8a2d\u5b9a",keywords:["dblink","FDW","PostgreSQL"]},o="PostgreSQL DB link (FDW)",a={},c=[{value:"FDW \u53c3\u8003\u8cc7\u6599",id:"fdw-\u53c3\u8003\u8cc7\u6599",level:2},{value:"Foreign Data Wrappers \u8a2d\u5b9a\u6b65\u9a5f",id:"foreign-data-wrappers-\u8a2d\u5b9a\u6b65\u9a5f",level:2},{value:"\u5b89\u88dd <strong>postgresql10-contrib</strong> \u5957\u4ef6\u3002",id:"\u5b89\u88dd-postgresql10-contrib-\u5957\u4ef6",level:2},{value:"pg_hba.conf \u8a2d\u5b9a\u9023\u7dda\u9a57\u8a3c\u65b9\u5f0f",id:"pg_hbaconf-\u8a2d\u5b9a\u9023\u7dda\u9a57\u8a3c\u65b9\u5f0f",level:2},{value:"\u5b89\u88dd postgres_fdw Extension",id:"\u5b89\u88dd-postgres_fdw-extension",level:2},{value:"\u8a2d\u5b9a Foreign Server",id:"\u8a2d\u5b9a-foreign-server",level:2},{value:"\u8a2d\u5b9a User Mapping",id:"\u8a2d\u5b9a-user-mapping",level:2},{value:"Local \u8a2d\u5b9a Foreign Table",id:"local-\u8a2d\u5b9a-foreign-table",level:2},{value:"Grant Authority of Foreign Table to Role",id:"grant-authority-of-foreign-table-to-role",level:2},{value:"\u67e5\u8a62 foreign server / foreign table",id:"\u67e5\u8a62-foreign-server--foreign-table",level:2},{value:"Local \u67e5\u8a62\u9060\u7aef\u8cc7\u6599\u4f7f\u7528\u7bc4\u4f8b",id:"local-\u67e5\u8a62\u9060\u7aef\u8cc7\u6599\u4f7f\u7528\u7bc4\u4f8b",level:2},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"postgresql-db-link-fdw",children:"PostgreSQL DB link (FDW)"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Foreign Data Wrappers (FDW)"}),"\n",(0,t.jsx)(n.li,{children:"\u53ef\u7528\u4ee5\u9032\u884c\u8de8\u8cc7\u6599\u5eab query, insert, delete \u6307\u5b9a\u8cc7\u6599\u8868\u7b49\u64cd\u4f5c\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u975e\u9810\u8a2d\u529f\u80fd\uff0c\u9700\u624b\u52d5\u5b89\u88dd PostgreSQL Extension"}),"\n",(0,t.jsxs)(n.li,{children:["\u53ef\u9023\u7d50\u591a\u7a2e\u8cc7\u6599\u6e90:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"SQL Databases: Oracle, MySQL, ODBC, JDBC"}),"\n",(0,t.jsx)(n.li,{children:"NoSQL Databases: CouchDB, Mongo, Redis"}),"\n",(0,t.jsx)(n.li,{children:"Files: CSV, Text, even JSON"}),"\n",(0,t.jsx)(n.li,{children:"Hadoop, Hive, Elastic Search"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"fdw-\u53c3\u8003\u8cc7\u6599",children:"FDW \u53c3\u8003\u8cc7\u6599"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://wiki.postgresql.org/wiki/Foreign_data_wrappers",children:"Foreign_data_wrappers "})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.postgresql.org/docs/10/postgres-fdw.html",children:"postgres-fdw"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"foreign-data-wrappers-\u8a2d\u5b9a\u6b65\u9a5f",children:"Foreign Data Wrappers \u8a2d\u5b9a\u6b65\u9a5f"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4ee5 PostgreSQL 10 \u70ba\u4f8b"}),"\n",(0,t.jsx)(n.li,{children:"role totem \u81ea totem DB \u9023\u7dda\u5230 insect DB \u70ba\u4f8b"}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\u9700\u5b89\u88dd ",(0,t.jsx)(n.strong,{children:"postgresql10-contrib"})," \u5957\u4ef6\u3002"]}),"\n",(0,t.jsx)(n.li,{children:"\u8a2d\u5b9a\u9023\u7dda\u9a57\u8a3c\u65b9\u5f0f pg_hba.conf"}),"\n",(0,t.jsx)(n.li,{children:"\u5b89\u88dd postgres_fdw Extension \u64f4\u5145\u529f\u80fd"}),"\n",(0,t.jsx)(n.li,{children:"\u8a2d\u5b9a Foreign Server"}),"\n",(0,t.jsx)(n.li,{children:"\u8a2d\u5b9a User Mapping: \u7576\u524d Role \u8207\u9060\u7aef DB role \u5efa\u7acb\u95dc\u806f\u3002"}),"\n",(0,t.jsx)(n.li,{children:"Local \u8a2d\u5b9a Foreign Table \u4ee3\u7406\u4eba"}),"\n",(0,t.jsx)(n.li,{children:"Grant Authority of Foreign Table to Role"}),"\n",(0,t.jsx)(n.li,{children:"\u67e5\u8a62 Foreign Server / Foreign Fable"}),"\n",(0,t.jsx)(n.li,{children:"Local \u67e5\u8a62\u9060\u7aef\u8cc7\u6599\u4f7f\u7528\u7bc4\u4f8b"}),"\n",(0,t.jsx)(n.li,{children:"\u5176\u4ed6"}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"\u5b89\u88dd-postgresql10-contrib-\u5957\u4ef6",children:["\u5b89\u88dd ",(0,t.jsx)(n.strong,{children:"postgresql10-contrib"})," \u5957\u4ef6\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shellscript",children:"# \u5217\u51fa\u5df2\u5b89\u88dd\u7684 postgresql \u5957\u4ef6\r\n$ yum list installed | grep postgresql\r\n \r\n# \u5b89\u88dd contrib \u5957\u4ef6\r\n$ yum install postgresql10-contrib\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pg_hbaconf-\u8a2d\u5b9a\u9023\u7dda\u9a57\u8a3c\u65b9\u5f0f",children:"pg_hba.conf \u8a2d\u5b9a\u9023\u7dda\u9a57\u8a3c\u65b9\u5f0f"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u9810\u8a2d\u9a57\u8a3c\u65b9\u5f0f\u70ba trust (\u53ea\u80fd\u8b93 role postgres \u4f7f\u7528 FDW)"}),"\n",(0,t.jsx)(n.li,{children:"trust \u6539 md5 \u505a\u70ba\u9023\u7dda\u9a57\u8a3c\u65b9\u5f0f"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"pg_hba.conf \u8a2d\u5b9a\u7bc4\u4f8b:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# TYPE  DATABASE        USER            ADDRESS                 METHOD\r\n \r\n# IPv4 local connections:\r\nhost     all             all             127.0.0.1/32             md5\r\n# IPv6 local connections:\r\n#host    all             all             ::1/128                  md5\r\nhost     all             all         192.168.X.0 255.255.255.0    md5\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5b89\u88dd-postgres_fdw-extension",children:"\u5b89\u88dd postgres_fdw Extension"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4ee5 postgres \u6b0a\u9650 \u5728 totem DB \u9032\u884c extension \u5b89\u88dd"}),"\n",(0,t.jsx)(n.li,{children:"\u4e26\u6388\u6b0a\u7d66\u6307\u5b9a Role totem \u4f7f\u7528"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"--login\r\npsql -U postgres\r\n \r\n--connection to totem\r\n\\c totem\r\n \r\n--install fdw\r\nCREATE EXTENSION postgres_fdw;\r\n \r\n--\u8b93 role totem \u53ef\u4ee5\u57f7\u884c FDW\r\nGRANT USAGE ON FOREIGN DATA WRAPPER postgres_fdw to totem;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u8a2d\u5b9a-foreign-server",children:"\u8a2d\u5b9a Foreign Server"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5728 totem DB \u5efa\u7acb\u9060\u7aef DB \u4ee3\u7406 server (\u6b64\u8655\u547d\u540d\u70ba foreign_insect_server)"}),"\n",(0,t.jsx)(n.li,{children:"\u53ef\u4f9d\u9700\u8981\u8a2d\u70ba read only / use_remote_estimate(\u7d71\u8a08)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"--by role totem on database totem\r\nCREATE SERVER foreign_insect_server\r\n        FOREIGN DATA WRAPPER postgres_fdw\r\n        OPTIONS (host '192.168.XX.XXX', port '5432', dbname 'insect');\r\n \r\n--on database totem set read only\r\nALTER SERVER foreign_insect_server OPTIONS (ADD updatable 'false');\r\n \r\n--\u5728 local \u7aef\u7d00\u9304 remote table \u7684\u7d71\u8a08\u503c, \u5927\u578b query \u6703\u9700\u8981\r\nALTER SERVER foreign_insect_server OPTIONS (ADD use_remote_estimate 'true');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u8a2d\u5b9a-user-mapping",children:"\u8a2d\u5b9a User Mapping"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u7576\u524d Role \u8207\u9060\u7aef DB role \u5efa\u7acb\u95dc\u806f\u3002","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"=> local role totem \u8207 remote role insect \u5efa\u95dc\u806f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"--user mapping\r\nCREATE USER MAPPING FOR totem\r\n        SERVER foreign_insect_server\r\n        OPTIONS (user 'insect', password 'pwOfInsect');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"local-\u8a2d\u5b9a-foreign-table",children:"Local \u8a2d\u5b9a Foreign Table"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5728\u672c\u5730\u7aef(totem DB)\u5efa\u7acb\u8207\u9060\u7aef(insect DB) table / view \u76f8\u896f\u7684\u8cc7\u6599\u8868"}),"\n",(0,t.jsx)(n.li,{children:"\u6b04\u4f4d\u7684 data type \u61c9\u914d\u5408\u9060\u7aef\u8a2d\u5b9a"}),"\n",(0,t.jsxs)(n.li,{children:["\u53ef\u4f9d\u9700\u8981\u70ba\u6b04\u4f4d\u55ae\u7368\u8a2d\u70ba\u552f\u8b80","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"local table name insect_category_substitute:"}),"\n",(0,t.jsx)(n.li,{children:"remote table name : insect_classicfication_category"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"    --create insect_category_substitute\r\n    --constraints are not supported\r\n    CREATE FOREIGN TABLE insect_category_substitute (\r\n        \"class_name\" text,\r\n        \"order_name\" text,\r\n        \"family_name\" text,\r\n        \"genus_name\" text\r\n    )\r\n            SERVER foreign_insect_server\r\n            OPTIONS (schema_name 'public', table_name 'insect_classicfication_category',\r\n                updatable 'false', use_remote_estimate 'true'); \r\n                --\u8a2d\u5b9a\u70ba read only / use_remote_estimate\n"})}),"\n",(0,t.jsx)(n.h2,{id:"grant-authority-of-foreign-table-to-role",children:"Grant Authority of Foreign Table to Role"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5c07 select insect_category_substitute \u7684\u6b0a\u9650\u7d66\u4e88 totem"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:" grant select on insect_category_substitute to totem;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u67e5\u8a62-foreign-server--foreign-table",children:"\u67e5\u8a62 foreign server / foreign table"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"pgAdmin \u4e0b\u53ea\u6703\u986f\u793a foreign server\uff0ctable / view \u7d30\u7bc0\u8981\u4e0b sql \u5f97\u77e5"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"--foreign server / table\r\nselect * from pg_foreign_data_wrapper;\r\n \r\nSELECT * FROM pg_foreign_server;\r\n \r\nSELECT * FROM pg_foreign_table;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"local-\u67e5\u8a62\u9060\u7aef\u8cc7\u6599\u4f7f\u7528\u7bc4\u4f8b",children:"Local \u67e5\u8a62\u9060\u7aef\u8cc7\u6599\u4f7f\u7528\u7bc4\u4f8b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select * from species sp \r\n       left join insect_category_substitute cat\r\n       on sp.genus_name = cat.genus_name;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5176\u4ed6",children:"\u5176\u4ed6"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u6301\u7e8c\u6574\u5408\u6e2c\u8a66\u6642\u91cd\u5efa\u8cc7\u6599\u5eab vs FDW \u6b0a\u9650\u8a2d\u5b9a\u554f\u984c"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u8b93 totem \u6709 superuser \u6b0a\u9650"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"alter role totem superuser;\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"template1 \u5b89\u88dd postgres_fdw"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"psql -U postgres -d template1\r\n\r\nCREATE EXTENSION postgres_fdw;\r\n\r\n--\u8b93 role totem \u53ef\u4ee5\u57f7\u884c\r\nGRANT USAGE ON FOREIGN DATA WRAPPER postgres_fdw to totem;\r\n\r\n--CI \u91cd\u5efa database \u6642, \u9810\u8a2d\u5c31\u662f template1, \u4e0d\u9700\u6307\u5b9a\r\nCREATE DATABASE totem WITH ENCODING='UTF8' OWNER=totem\r\n\r\n--TEMPLATE=template0 \r\nTABLESPACE=totem;\r\n\n"})})]})}function g(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);