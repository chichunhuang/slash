"use strict";(globalThis.webpackChunkinsect_totem=globalThis.webpackChunkinsect_totem||[]).push([[285],{24815:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column","title":"\u65b0\u589e\u4fee\u6539 JSONB \u6b04\u4f4d\u503c","description":"PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c\u66f4\u6539","source":"@site/docs/140_PostgreSQL/JSONB/002_PostgreSQL_Update_JSONB_Column.md","sourceDirName":"140_PostgreSQL/JSONB","slug":"/PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Update_JSONB_Column","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"\u65b0\u589e\u4fee\u6539 JSONB \u6b04\u4f4d\u503c","description":"PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c\u66f4\u6539","keywords":["JSONB","PostgreSQL"]},"sidebar":"totem_sidebar","previous":{"title":"PostgreSQL Jsonb \u96dc\u9805\u7d00\u9304","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Jsonb_misc"},"next":{"title":"\u522a\u9664 JSONB \u8cc7\u6599","permalink":"/docs/PostgreSQL/JSONB/PostgreSQL_Delete_attr"}}');var t=s(74848),i=s(28453);const o={title:"\u65b0\u589e\u4fee\u6539 JSONB \u6b04\u4f4d\u503c",description:"PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c\u66f4\u6539",keywords:["JSONB","PostgreSQL"]},l=void 0,c={},d=[{value:"\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c",id:"\u66f4\u6539-postgresql-jsonb-\u6b04\u4f4d\u8cc7\u6599\u503c",level:2},{value:"\u67e5\u8a62 JSONB \u5c6c\u6027\u8cc7\u6599",id:"\u67e5\u8a62-jsonb-\u5c6c\u6027\u8cc7\u6599",level:2},{value:"\u66f4\u6539 JSONB \u65b9\u5f0f",id:"\u66f4\u6539-jsonb-\u65b9\u5f0f",level:2},{value:"\u66f4\u6539 JSONB \u5c6c\u6027\u503c\u85c9\u7531 <code><strong>jsonb_set()</strong></code>",id:"\u66f4\u6539-jsonb-\u5c6c\u6027\u503c\u85c9\u7531-jsonb_set",level:2},{value:"\u65b0\u589e JSONB \u5c6c\u6027\u503c <code><strong>jsonb_insert()</strong></code>",id:"\u65b0\u589e-jsonb-\u5c6c\u6027\u503c-jsonb_insert",level:2},{value:"\u88dc\u9f4a JSONB \u5c6c\u6027\u503c\u9577\u5ea6",id:"\u88dc\u9f4a-jsonb-\u5c6c\u6027\u503c\u9577\u5ea6",level:2},{value:"Reference",id:"reference",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"jsonb_set function \u53ef\u7528\u4f86\u65b0\u589e\u6216\u4fee\u6539 Json \u5c6c\u6027\u503c"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u66f4\u6539-postgresql-jsonb-\u6b04\u4f4d\u8cc7\u6599\u503c",children:"\u66f4\u6539 PostgreSQL JSONB \u6b04\u4f4d\u8cc7\u6599\u503c"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u60c5\u5883: Table \u5165\u5b78\u8003\u8a66\u8cc7\u6599\u8868(Entrance_Examination)"}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"id(bigint)"}),(0,t.jsx)(n.th,{children:"Admission_Ticket(character)"}),(0,t.jsx)(n.th,{children:"raw_data(jsonb)"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"AAA001"}),(0,t.jsx)(n.td,{children:'{"City":"TPE", "School":"NTU" , "Score":"60" }'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"BBB001"}),(0,t.jsx)(n.td,{children:'{"City":"TYN", "School":"NCHU", "Score":"70" }'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"CCC001"}),(0,t.jsx)(n.td,{children:'{"City":"HSZ", "School":"NCCU", "Score":"80" }'})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u67e5\u8a62-jsonb-\u5c6c\u6027\u8cc7\u6599",children:"\u67e5\u8a62 JSONB \u5c6c\u6027\u8cc7\u6599"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ->> \u7b26\u865f\u9032\u884c JSONB \u6b04\u4f4d\u4e0b\u5c6c\u6027\u503c\u67e5\u8a62","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"->> \u56de\u50b3 String"}),"\n",(0,t.jsx)(n.li,{children:"->  \u56de\u50b3 Json Object"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"  select raw_data ->> 'School' as \"School\" from Entrance_Examination where Admission_Ticket = 'AAA001';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u66f4\u6539-jsonb-\u65b9\u5f0f",children:"\u66f4\u6539 JSONB \u65b9\u5f0f"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u65b9\u5f0f\u4f86\u505a\u5c6c\u6027\u503c\u4fee\u6539\u3002"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"jsonb_set()"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"jsonb_insert()"})}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"\u66f4\u6539-jsonb-\u5c6c\u6027\u503c\u85c9\u7531-jsonb_set",children:["\u66f4\u6539 JSONB \u5c6c\u6027\u503c\u85c9\u7531 ",(0,t.jsx)("code",{children:(0,t.jsx)(n.strong,{children:"jsonb_set()"})})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"jsonb_set \u7f6e\u5165\u7269\u4ef6\uff0c\u53d6\u4ee3\u65e2\u6709\u8cc7\u6599, Replacement"}),"\n",(0,t.jsx)(n.li,{children:"\u6ce8\u610f: jsonb column \u81f3\u5c11\u8981\u5148\u6709\u4e00\u500b\u7a7a\u7269\u4ef6(\u4e0d\u80fd\u70ba null)\u624d\u80fd\u9032\u884c set\u3002"}),"\n",(0,t.jsx)(n.li,{children:"create_if_missing \u9810\u8a2d\u70ba true\uff0c\u7576\u7121\u6b64 attribute \u6642\uff0cupdate \u8b8a insert\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"jsonb_set \u8a9e\u6cd5:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"\tjsonb_set(\r\n\t  target JSONB, path TEXT[], new_value JSONB[, create_if_missing BOOLEAN]\r\n\t) -> JSONB\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4e0b\u65b9 replacement \u7bc4\u4f8b: school NTU \u53d6\u4ee3\u6210 NCHU","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5c07\u5b78\u6821\u6539\u6210 NCHU (JSON \u7d50\u69cb\u672a\u6539\u8b8a)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'   update Entrance_Examination set raw_data = jsonb_set( raw_data, array[\'School\'], \'"NCHU"\'::jsonb )\r\n           where Admission_Ticket = \'AAA001\';\r\n           \r\n--\x3e\r\n{\r\n  "City":"TPE", \r\n  "School":"NCHU" , \r\n  "Score":"60"  \r\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5c07\u5b78\u6821\u6539\u6210 NCHU\uff0c\u4e26\u8a2d\u5b9a\u5206\u6821\u70ba Taipei (School \u6539\u4e00\u500b JSON \u7d50\u69cb)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'   update Entrance_Examination set raw_data = jsonb_set( raw_data, array[\'School\'], \'{"Campus":"NCHU", "Branch_Campus":"Taipei"}\' )\r\n           where Admission_Ticket = \'AAA001\';\r\n           \r\n--\x3e\r\n"{\r\n    "City": "TPE",\r\n    "Score": "60",\r\n    "School": {\r\n        "Campus": "NCHU",\r\n        "Bbranch_Ccampus": "Taipei"\r\n    }\r\n}"           \n'})}),"\n",(0,t.jsxs)(n.h2,{id:"\u65b0\u589e-jsonb-\u5c6c\u6027\u503c-jsonb_insert",children:["\u65b0\u589e JSONB \u5c6c\u6027\u503c ",(0,t.jsx)("code",{children:(0,t.jsx)(n.strong,{children:"jsonb_insert()"})})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u8a3b: \u6b64\u8a9e\u6cd5 ",(0,t.jsxs)("span",{style:{color:"#0044FF"},children:[" ",(0,t.jsx)(n.strong,{children:"PostgreSQL 10+ \u624d\u652f\u63f4"})," "]})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"\tjsonb_insert(\r\n\t  target JSONB, path TEXT[], new_value JSONB[, insert_after BOOLEAN]\r\n\t) -> JSONB\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"update Entrance_Examination set raw_data = jsonb_insert( raw_data, array['Country'], '\"TW\"'::jsonb )\r\n           where Admission_Ticket = 'AAA001';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u88dc\u9f4a-jsonb-\u5c6c\u6027\u503c\u9577\u5ea6",children:"\u88dc\u9f4a JSONB \u5c6c\u6027\u503c\u9577\u5ea6"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5206\u6578\u88dc0\u5230\u56db\u4f4d"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"--\u88dc\u96f6\uff0c\u8f49\u63db\u70ba jsonb \u505a update\r\nupdate Entrance_Examination \r\n     set raw_data = jsonb_set( raw_data, '{Score}', quote_ident(lpad(raw_data ->> 'Score', 4, '0'))::jsonb )\r\n     where Admission_Ticket = 'AAA001';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/40583639/update-multiple-values-in-a-jsonb-data-in-postgresql",children:'\u6279\u6b21\u66f4\u6539 Jsonb \u7684\u5167\u5bb9: \u4f7f\u7528 "||"'})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.postgresql.org/docs/9.5/functions-json.html",children:"https://www.postgresql.org/docs/9.5/functions-json.html"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(96540);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);