"use strict";(globalThis.webpackChunkinsect_totem=globalThis.webpackChunkinsect_totem||[]).push([[141],{28453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>o});var t=r(96540);const i={},a=t.createContext(i);function s(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:n},e.children)}},62540:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Java/Spring/Spring_Hibernate_Postgresql_Dialect","title":"Spring \u642d\u914d\u4f7f\u7528 DB Dialect","description":"Spring with PostgreSQL Dialect","source":"@site/docs/110_Java/30_Spring/Spring_Hibernate_Postgresql_Dialect.md","sourceDirName":"110_Java/30_Spring","slug":"/Java/Spring/Spring_Hibernate_Postgresql_Dialect","permalink":"/docs/Java/Spring/Spring_Hibernate_Postgresql_Dialect","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Spring \u642d\u914d\u4f7f\u7528 DB Dialect","description":"Spring with PostgreSQL Dialect","keywords":["Spring","PostgreSQL","Dialect"]},"sidebar":"totem_sidebar","previous":{"title":"Spring \u5229\u7528 AOP \u65bc\u7570\u5e38\u767c\u751f\u6642\u5bc4\u901a\u77e5\u4fe1","permalink":"/docs/Java/Spring/Spring_AOP_Exception_Mail"},"next":{"title":"Spring \u4e0b Properties \u6a94\u6ce8\u5165\u8207\u4f7f\u7528\u7bc4\u4f8b","permalink":"/docs/Java/Spring/Spring_List_Proerties"}}');var i=r(74848),a=r(28453);const s={title:"Spring \u642d\u914d\u4f7f\u7528 DB Dialect",description:"Spring with PostgreSQL Dialect",keywords:["Spring","PostgreSQL","Dialect"]},o=void 0,c={},l=[{value:"\u5148\u8a2d\u5b9a PostgreSQL Dialect",id:"\u5148\u8a2d\u5b9a-postgresql-dialect",level:2},{value:"\u8a3b\u518a\u81ea\u884c\u5b9a\u7fa9 function",id:"\u8a3b\u518a\u81ea\u884c\u5b9a\u7fa9-function",level:2},{value:"\u4f7f\u7528\u7bc4\u4f8b",id:"\u4f7f\u7528\u7bc4\u4f8b",level:2}];function p(e){const n={blockquote:"blockquote",br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Spring Framework \u8207 Hibernate ORM \u6574\u5408\u5f8c\uff0c\u53ef\u642d\u914d\u63a1\u7528\u4e0d\u540c\u7684 Datasource\uff0c",(0,i.jsx)(n.br,{}),"\n","\u9019\u4fbf\u7684\u7bc4\u4f8b\u662f\uff0c",(0,i.jsx)(n.br,{}),"\n","\u8b93 Spring \u7684 HibernateTemplate / JdbcTemplate \u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 PostgreSQL \u7684\u539f\u751f functions\u3002",(0,i.jsx)(n.br,{}),"\n","\u4e26\u4ecb\u7d39\uff0c\u5982\u4f55\u8a3b\u518a\u81ea\u884c\u958b\u767c\u7684 PostgreSQL function \u4f9b Spring \u7684 HibernateTemplate \u4f7f\u7528\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u81ea\u884c\u958b\u767c function \u4e3b\u8981\u76ee\u7684:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53ef\u81ea\u8a02\u4efb\u4f55\u8cc7\u6599\u5eab\u652f\u63f4\u7684\u51fd\u6578\u8a9e\u6cd5"}),"\n",(0,i.jsx)(n.li,{children:"\u4e0d\u9700\u5efa\u7acb Java Function\uff0c\u53ea\u7528\u6a21\u677f\u63cf\u8ff0 SQL"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u63f4\u591a\u53c3\u6578\u3001\u591a\u578b\u5225\u56de\u50b3"}),"\n",(0,i.jsx)(n.li,{children:"\u4f7f\u7528 SQLFunctionTemplate \u5de5\u5177"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5148\u8a2d\u5b9a-postgresql-dialect",children:"\u5148\u8a2d\u5b9a PostgreSQL Dialect"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4e0b\u9762\u7bc4\u4f8b\u8a2d\u5b9a\u662f\u63a1 Hibernate 5x \u7248\u672c\uff0c6x \u8a2d\u5b9a\u4e0d\u5b8c\u5168\u76f8\u540c\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Hibernate 3.3 \u5f8c\uff0chibernate.cache.provider_class \u88ab Deprecated\uff0c\u6539\u7528 hibernate.cache.region.factory_class"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"applicationContext.xml"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u9019\u908a\u7bc4\u4f8b\u662f\u60f3\u5728 Spring HibernateTemplate \u4e2d\u4f7f\u7528\u81ea\u8a02 function\uff0c\u6240\u4ee5\u4ee5 xml \u8a2d\u5b9a\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53ef\u4f9d\u9700\u6c42\u6539\u6210 property \u6a94\u8a2d\u5b9a\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u7bc4\u4f8b\u662f\u67e5\u627e classpath \u4e0b\u7684 hbm \u8207\u6383\u63cf package totem \u4e0b\u7684 Hibernate \u76f8\u95dc annotated class\u3002"}),"\n",(0,i.jsx)(n.li,{children:"totem.util.hibernate.CustomPostgreSQL94Dialect \u984d\u5916\u81ea\u884c\u518d\u64f4\u5145\u7684 Dialect \u5de5\u5177"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'     <bean id="sessionFactory"\r\n            class="org.springframework.orm.hibernate5.LocalSessionFactoryBean"\r\n            destroy-method="destroy">\r\n            <property name="dataSource" ref="dataSource" />\r\n            <property name="mappingLocations">\r\n                    <value>classpath*:**/*.hbm.xml</value>\r\n            </property>\r\n            <property name="hibernateProperties">\r\n                <props>\r\n                    <prop key="hibernate.dialect">\r\n                        totem.util.hibernate.CustomPostgreSQL94Dialect\r\n                    </prop>\r\n                    \x3c!-- \r\n                    <prop key="hibernate.dialect">\r\n                        org.hibernate.dialect.PostgreSQLDialect\r\n                    </prop>\r\n                     --\x3e\r\n                    <prop key="hibernate.show_sql">true</prop>\r\n                    <prop key="hibernate.format_sql">false</prop>\r\n                    <prop key="hibernate.cache.use_query_cache">true</prop>\r\n                    \r\n                    <prop key="hibernate.cache.region.factory_class">org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory</prop>\r\n                    \r\n                    <prop key="hibernate.cache.provider_configuration_file_resource_path">/ehcache.xml</prop>\r\n                    <prop key="hibernate.schema_update.unique_constraint_strategy">RECREATE_QUIETLY</prop>\r\n                    <prop key="hibernate.id.new_generator_mappings">false</prop>\r\n                    \r\n                    <prop key="hibernate.jdbc.fetch_size">100</prop>\r\n                    <prop key="hibernate.jdbc.batch_size">100</prop>\r\n                    \r\n                </props>\r\n            </property>\r\n            <property name="packagesToScan" value="totem"/>\r\n        </bean>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u8a3b\u518a\u81ea\u884c\u5b9a\u7fa9-function",children:"\u8a3b\u518a\u81ea\u884c\u5b9a\u7fa9 function"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CustomPostgreSQL94Dialect.java \u7e7c\u627f\u81ea PostgreSQL94Dialect\uff0c\u4e26\u8a3b\u518a\u81ea\u884c\u8a2d\u5b9a\u7684 function\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["\u4e0b\u5217\u7bc4\u4f8b\u8a2d\u8a08\u4e00\u500b date_between \u51fd\u6578\uff0c\u7528\u4f86\u5c07 from date \u8abf\u6574\u5230\u8a72\u65e5\u7684\u51cc\u6668\uff0c\u8207 to date \u8abf\u6574\u5230\u8a72\u65e5\u7684\u7d50\u675f\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"?1,?2,?3.... \u6703\u88ab\u53d6\u4ee3\u70ba\u50b3\u5165\u7684\u7b2c 1,2,3 \u4f4d\u7684 argument\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"    column BETWEEN date_trunc('day', :from)\r\n            AND date_trunc('day', :to) + interval '1 day' - interval '1 second'\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"    import org.hibernate.dialect.PostgreSQL94Dialect;\r\n    import org.hibernate.dialect.function.SQLFunctionTemplate;\r\n    import org.hibernate.type.StringType;\r\n    \r\n    public class CustomPostgreSQL94Dialect extends PostgreSQL94Dialect {\r\n        public CustomPostgreSQL94Dialect() {\r\n            super();\r\n            \r\n            // \u8a3b\u518a\u81ea\u8a02\u7684 date_between \u51fd\u6578\uff0c\u81ea\u52d5\u5c07\u50b3\u5165\u7684 from \u8df3\u5230\u8a72\u65e5\u671f\u7684\u8d77\u59cb\u6642\u9593, to \u8df3\u5230\u8a72\u65e5\u671f\u7684\u7d50\u675f\u6642\u9593\r\n            registerFunction(\r\n                \"date_between\",\r\n                new SQLFunctionTemplate(\r\n                    StandardBasicTypes.BOOLEAN,\r\n                    \"?1 between date_trunc('day', ?2) and (date_trunc('day', ?3) + interval '1 day' - interval '1 second')\"\r\n                )\r\n            );\r\n        }\r\n    }\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4f7f\u7528\u7bc4\u4f8b",children:"\u4f7f\u7528\u7bc4\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'    String hql = " FROM Event e WHERE date_between(e.logTime, :from, :to)";\r\n    \r\n    List<Event> result = session.createQuery(hql, Event.class)\r\n        .setParameter("from", fromDate)  \r\n        .setParameter("to", toDate)\r\n        .getResultList();\n'})})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);