"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[6822],{17605:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>i});const r=JSON.parse('{"id":"Tomcat/Tomcat_Https_Private","title":"Tomcat https \u8a2d\u5b9a","description":"Tomcat Https Setting","source":"@site/docs/170_Tomcat/Tomcat_Https_Private.md","sourceDirName":"170_Tomcat","slug":"/Tomcat/Tomcat_Https_Private","permalink":"/docs/Tomcat/Tomcat_Https_Private","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Tomcat https \u8a2d\u5b9a","description":"Tomcat Https Setting","keywords":["Tomcat","Https"]},"sidebar":"totem_sidebar","previous":{"title":"Tomcat Cookie \u5b89\u5168\u6027\u8a2d\u5b9a","permalink":"/docs/Tomcat/Tomcat_Httponly"},"next":{"title":"Tomcat \u81ea\u52d5\u5207\u5272 Log \u6a94","permalink":"/docs/Tomcat/Tomcat_Log_Rotate"}}');var s=t(74848),o=t(28453);const c={title:"Tomcat https \u8a2d\u5b9a",description:"Tomcat Https Setting",keywords:["Tomcat","Https"]},l=void 0,a={},i=[{value:"JDK \u751f\u6210 keystore",id:"jdk-\u751f\u6210-keystore",level:2},{value:"Tomcat Https connector \u8a2d\u5b9a",id:"tomcat-https-connector-\u8a2d\u5b9a",level:2},{value:"\u90e8\u5c6c\u6e2c\u8a66",id:"\u90e8\u5c6c\u6e2c\u8a66",level:2},{value:"Tomcat security constraint \u8a2d\u5b9a",id:"tomcat-security-constraint-\u8a2d\u5b9a",level:2},{value:"\u6458\u8981 keystore \u76f8\u95dc\u6307\u4ee4",id:"\u6458\u8981-keystore-\u76f8\u95dc\u6307\u4ee4",level:2}];function d(e){const n={br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["\u9019\u908a\u7bc4\u4f8b\u662f\u4ee5 JDK \u7684 keytool \u4f86\u7522\u751f KeyStore",(0,s.jsx)(n.br,{}),"\n","\u8996\u9700\u8981\u5411\u7b2c\u4e09\u65b9\u7533\u8acb"]}),"\n",(0,s.jsx)(n.h2,{id:"jdk-\u751f\u6210-keystore",children:"JDK \u751f\u6210 keystore"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Linux \u4e0b key \u5b58\u653e\u4f4d\u7f6e","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"/home/[USER_NAME]/.keystore"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Windows \u4e0b key \u5b58\u653e\u4f4d\u7f6e","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"C:\\Users\\[UserName]"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"\u82e5\u9808\u91cd\u65b0\u5efa\u7acb\u6642\uff0c\u522a\u9664\u820a key \u91cd\u5efa\u5373\u53ef"}),"\n",(0,s.jsxs)(n.li,{children:["\u8a3b:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e0b\u9762\u7bc4\u4f8b\u4e2d\u4ee5 tomcatssl \u4f5c\u70ba key \u7684\u5225\u540d"}),"\n",(0,s.jsx)(n.li,{children:"validity 36500 \u6307 keysore \u6709\u6548\u671f\u9650 100 \u5e74t"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\r\n    $ keytool -genkey -alias tomcatssl -keyalg RSA -validity 36500\r\n    \u8f38\u5165 keystore \u5bc6\u78bc\uff1a  \r\n    \u60a8\u7684\u540d\u5b57\u8207\u59d3\u6c0f\u70ba\u4f55\uff1f\r\n      [Unknown]\uff1a  insecttotem\r\n    \u60a8\u7684\u7de8\u5236\u55ae\u4f4d\u540d\u7a31\u70ba\u4f55\uff1f\r\n      [Unknown]\uff1a  insecttotem\r\n    \u60a8\u7684\u7d44\u7e54\u540d\u7a31\u70ba\u4f55\uff1f\r\n      [Unknown]\uff1a  insecttotem\r\n    \u60a8\u6240\u5728\u7684\u57ce\u5e02\u6216\u5730\u5340\u540d\u7a31\u70ba\u4f55\uff1f\r\n      [Unknown]\uff1a  tw   \r\n    \u60a8\u6240\u5728\u7684\u5dde\u53ca\u7701\u4efd\u540d\u7a31\u70ba\u4f55\uff1f\r\n      [Unknown]\uff1a  tw\r\n    \u8a72\u55ae\u4f4d\u7684\u4e8c\u5b57\u570b\u78bc\u70ba\u4f55\r\n      [Unknown]\uff1a  tw\r\n    CN=insecttotem, OU=insecttotem, O=insecttotem, L=tw, ST=tw, C=tw \u6b63\u78ba\u55ce\uff1f\r\n      [\u5426]\uff1a  Y\r\n    \r\n    \u8f38\u5165 <tomcatssl> \u7684\u4e3b\u5bc6\u78bc\r\n        \uff08RETURN \u5982\u679c\u548c keystore \u5bc6\u78bc\u76f8\u540c\uff09\uff1a  \r\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tomcat-https-connector-\u8a2d\u5b9a",children:"Tomcat Https connector \u8a2d\u5b9a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8a2d\u5b9a 443 \u6216 8443 port \u7684 connector\uff0c\u4f9d\u5be6\u969b\u9700\u8981\u8abf\u6574"}),"\n",(0,s.jsx)(n.li,{children:"keystore \u5bc6\u78bc\u5fc5\u9808\u548c keystorePass\u76f8\u540c"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Linux \u4e0b"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"~/tomcat/conf/server.xml"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'    <Connector port="8443" \r\n        protocol="HTTP/1.1" \r\n        SSLEnabled="true"\r\n        maxThreads="150" \r\n        scheme="https" \r\n        secure="true" \r\n        keystorePass="tomcatsslpw" \r\n        keystoreFile="/home/username/.keystore"\r\n        clientAuth="false" sslProtocol="TLS" />\r\n\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Windows \u4e0b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'    <Connector port="8443" \r\n        protocol="org.apache.coyote.http11.Http11NioProtocol" \r\n        SSLEnabled="true"\r\n        maxThreads="150" \r\n        scheme="https" \r\n        secure="true" \r\n        keystorePass="tomcatsslpw" \r\n        keystoreFile="e:\\.keystore"\r\n        clientAuth="false" sslProtocol="TLS" />\r\n     \r\n     \r\n    \x3c!-- Tomcat8.5, 9 \u7684\u5beb\u6cd5 --\x3e\r\n    <Connector port="8443" \r\n        protocol="org.apache.coyote.http11.Http11NioProtocol" \r\n        maxThreads="150" \r\n        SSLEnabled="true">\r\n        \r\n        <SSLHostConfig>\r\n            <Certificate certificateKeystoreFile="/home/server/.keystore" certificateKeystorePassword="tomcatssl" type="RSA" />\r\n        </SSLHostConfig>\r\n    </Connector>\r\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u90e8\u5c6c\u6e2c\u8a66",children:"\u90e8\u5c6c\u6e2c\u8a66"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728 tomcat \u4e2d\u4f48\u7f72\u61c9\u7528\u7a0b\u5f0f\u5f8c\uff0c\u4ee5 8443 \u9023\u7dda\u5373\u53ef"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    https://localhost:8443/myproject\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tomcat-security-constraint-\u8a2d\u5b9a",children:"Tomcat security constraint \u8a2d\u5b9a"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 tomcat/conf/web.xml \u52a0\u4e0a\u5b89\u5168\u9650\u5b9a (security constraint)\uff0c",(0,s.jsx)(n.br,{}),"\n","\u5982\u679c\u8981\u6c42\u8a66\u5716\u900f\u904e HTTP(\u4e0d\u5b89\u5168\u9023\u7dda) \u5b58\u53d6 transport guarantee \u70ba CONFIDENTIAL \u7684 URL\uff0c",(0,s.jsx)(n.br,{}),"\n","\u5c07\u88ab\u81ea\u52d5\u91cd\u65b0\u5c0e\u5411\u4f7f\u7528 HTTPS \u7684\u76f8\u540c URL\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u8a3b: \u9019\u53ef\u4ee5\u8a2d\u5b9a\u5728 Tomcat \u5168\u57df\u4e0b\uff0c\u6216\u500b\u5225\u5c08\u6848\u81ea\u884c\u8a2d\u5b9a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"    <security-constraint>\r\n          <web-resource-collection>\r\n                 <web-resource-name>Entire Web App</web-resource-name>\r\n                 <url-pattern>/*</url-pattern>\r\n         </web-resource-collection>\r\n         <user-data-constraint>\r\n                 <transport-guarantee>CONFIDENTIAL</transport-guarantee>\r\n         </user-data-constraint>\r\n    </security-constraint>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6458\u8981-keystore-\u76f8\u95dc\u6307\u4ee4",children:"\u6458\u8981 keystore \u76f8\u95dc\u6307\u4ee4"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u7522\u751f\u91d1\u9300\u5c0d(RSA\u70ba\u975e\u5c0d\u7a31\u52a0\u5bc6\u7684\u6f14\u7b97\u6cd5)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    # generate keystore\r\n    keytool -genkey -alias xxxx -keyalg RSA -validity 36500\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u532f\u51fa"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    # export cert\r\n    keytool -export -alias xxxx -file ody_tomcatssl.crt\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u522a\u9664"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    # delete  cert\r\n    keytool -delete -alias xxxx -keystore .keystore\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u532f\u5165"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    # import new insecttotem cert\r\n    keytool -import -alias insecttotem -file insecttotem_from.crt\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u67e5\u8a62"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    keytool -list -v -keystore .keystore\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u7522\u751f\u6191\u8b49\u7533\u8acb\u6a94"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    keytool -certreq -alias xxx -file certreq.txt -keystore .keystore\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u67e5\u8a62 PKCS12 \u985e\u578b keystore \u7684\u5167\u5bb9"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    keytool -list -v -keystore .keystore -storetype pkcs12\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u5efa\u7acb\u4e00\u500b\u542b\u6709\u79c1\u9470\u7684 keystore"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    keytool -genkey -alias keyAlias -keyalg RSA -keystore keystore.jks\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u4fee\u6539 keystore \u7684\u5bc6\u78bc"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"    keytool -storepasswd -new newPassword -keystore keystore.jks\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>l});var r=t(96540);const s={},o=r.createContext(s);function c(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);