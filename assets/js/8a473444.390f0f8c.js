"use strict";(globalThis.webpackChunkinsect_totem=globalThis.webpackChunkinsect_totem||[]).push([[824],{28453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>a});var t=n(96540);const i={},s=t.createContext(i);function l(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(s.Provider,{value:r},e.children)}},35226:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>x,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Java/Java_CSV_UTF8_BOM","title":"Excel \u958b\u555f CSV \u767c\u751f\u4e2d\u6587\u4e82\u78bc","description":"CSV \u589e\u52a0 UTF-8 BOM","source":"@site/docs/110_Java/Java_CSV_UTF8_BOM.md","sourceDirName":"110_Java","slug":"/Java/Java_CSV_UTF8_BOM","permalink":"/docs/Java/Java_CSV_UTF8_BOM","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Excel \u958b\u555f CSV \u767c\u751f\u4e2d\u6587\u4e82\u78bc","description":"CSV \u589e\u52a0 UTF-8 BOM","keywords":["Java","CSV","BOM"]},"sidebar":"totem_sidebar","previous":{"title":"Hibernate \u4e00\u7d1a\u4e8c\u7d1a\u5feb\u53d6","permalink":"/docs/Java/Hibernate_Cache"},"next":{"title":"Java \u53d6 IP","permalink":"/docs/Java/Java_IP"}}');var i=n(74848),s=n(28453);const l={title:"Excel \u958b\u555f CSV \u767c\u751f\u4e2d\u6587\u4e82\u78bc",description:"CSV \u589e\u52a0 UTF-8 BOM",keywords:["Java","CSV","BOM"]},a=void 0,c={},d=[{value:"\u95dc\u65bc BOM",id:"\u95dc\u65bc-bom",level:2},{value:"UTF-8 \u7684 BOM",id:"utf-8-\u7684-bom",level:2},{value:"\u7bc4\u4f8b",id:"\u7bc4\u4f8b",level:2},{value:"char: \\uFEFF",id:"char-ufeff",level:3},{value:"bytes: 0xEF, 0xBB, 0xBF",id:"bytes-0xef-0xbb-0xbf",level:3},{value:"\u8996\u9700\u8981\u6dfb\u52a0 UTF-8 BOM",id:"\u8996\u9700\u8981\u6dfb\u52a0-utf-8-bom",level:3},{value:"\u6bd4\u8f03",id:"\u6bd4\u8f03",level:2}];function o(e){const r={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.p,{children:["\u90e8\u5206 CSV \u6a94\uff0c\u4ee5 MS Excel \u958b\u555f\u5f8c\uff0c\u6703\u767c\u751f\u4e2d\u6587\u4e82\u78bc\u7684\u554f\u984c",(0,i.jsx)(r.br,{}),"\n","\u6539\u4ee5 NP++ \u958b\u555f\u5f8c\uff0c\u537b\u6c92\u6709\u4e2d\u6587\u4e82\u78bc\u7684\u554f\u984c",(0,i.jsx)(r.br,{}),"\n","\u6aa2\u67e5 Encoding Type \u70ba UTF-8 (w/o BOM)",(0,i.jsx)(r.br,{}),"\n","\u5c07 Encoding Type \u6539\u70ba UTF-8 (with BOM) \u5f8c\u5b58\u6a94\u4e26\u7528 MS Excel\u958b\u555f\uff0c\u4e2d\u6587\u986f\u793a\u6b63\u5e38"]}),"\n",(0,i.jsx)("span",{style:{color:"#FF1100"},children:(0,i.jsx)(r.strong,{children:"\u9019\u908a\u8a0e\u8ad6\u7684\u662f UTF-8 \u4e0b\u7684\u60c5\u5883"})}),"\n",(0,i.jsx)(r.h2,{id:"\u95dc\u65bc-bom",children:"\u95dc\u65bc BOM"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"BOM: Byte order mark"}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"http://en.wikipedia.org/wiki/Byte_order_mark",children:"http://en.wikipedia.org/wiki/Byte_order_mark"})}),"\n",(0,i.jsx)(r.li,{children:"\u4f4d\u5143\u7d44\u9806\u5e8f\u6a19\u8a18 (BOM) \u662f\u4e00\u500b Unicode \u5b57\u7b26\uff0c\r\n\u7528\u65bc\u8868\u793a\u6587\u5b57\u6a94\u6848\u6216\u6d41\u7684\u4f4d\u5143\u7d44\u9806\u5e8f (\u4f4d\u5143\u7d44\u9806\u5e8f)\u3002\u5176\u4ee3\u865f\u9ede\u662f U+FEFF\u3002\r\nBOM \u7684\u4f7f\u7528\u662f\u53ef\u9078\u7684\uff0c\u5982\u679c\u4f7f\u7528\uff0c\u5247\u61c9\u51fa\u73fe\u5728\u6587\u5b57\u6d41\u7684\u958b\u982d\u3002\r\n\u9664\u4e86\u4f5c\u70ba\u4f4d\u5143\u7d44\u9806\u5e8f\u6307\u793a\u7b26\u7684\u7279\u5b9a\u7528\u9014\u4e4b\u5916\uff0c\r\nBOM \u5b57\u5143\u9084\u53ef\u4ee5\u6307\u793a\u6587\u5b57\u63a1\u7528\u5e7e\u7a2e Unicode \u8868\u793a\u5f62\u5f0f\u4e2d\u7684\u54ea\u4e00\u7a2e\u9032\u884c\u7de8\u78bc\u3002"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"utf-8-\u7684-bom",children:"UTF-8 \u7684 BOM"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Excel \u9700\u8981\u4e0b\u9762\u4e09\u500b bytes \u624d\u80fd\u6b63\u78ba\u8fa8\u8b58 UTF-8 \u7684 CSV \u6a94\u6848"}),"\n",(0,i.jsxs)(r.li,{children:["\u6ce8\u610f \\uFEFF \u7de8\u78bc\u6210 UTF-8 \u6642\u6703\u5c31\u662f\u4e0b\u9762\u4e09\u500b bytes","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u5176\u4ed6\u7de8\u78bc\u4e0d\u9069\u7528\uff0c\u6703\u662f\u4e0d\u540c\u5167\u5bb9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"\u4ee5 byte \u8868\u793a"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"    0xEF, 0xBB, 0xBF\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"\u4ee5 Char \u8868\u793a"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u4f60\u5beb\u5165 \\uFEFF \u5230\u4e00\u500b\u4ee5 UTF-8 \u7de8\u78bc\u7684\u6a94\u6848\u4e2d\u6642\uff0c\u5be6\u969b\u4e0a\u5c31\u662f\u5beb\u5165\u4e86\u4e0a\u65b9\u4e09\u500b bytes"}),"\n",(0,i.jsx)(r.li,{children:"\\uFEFF: \u4e00\u500b\u7279\u6b8a Unicode \u5b57\u5143\u53c8\u7a31\u70ba \u310bZERO WIDTH NO-BREAK SPACE (ZWNBSP)"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"   '\\uFEFF' : \u5728 UTF-8 \u4e2d\u7684\u5be6\u969b bytes \u662f 0xEF 0xBB 0xBF \n"})}),"\n",(0,i.jsx)(r.h2,{id:"\u7bc4\u4f8b",children:"\u7bc4\u4f8b"}),"\n",(0,i.jsx)(r.h3,{id:"char-ufeff",children:"char: \\uFEFF"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"\u8f38\u51fa\u6a94\u88dc\u4e0a FEFF"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-javascript",children:'    import java.io.BufferedWriter;\r\n    import java.io.FileOutputStream;\r\n    import java.io.OutputStreamWriter;\r\n    import java.io.Writer;\r\n    import java.nio.charset.StandardCharsets;\r\n    \r\n    public class Utf8BomCsvWriter {\r\n        public static void main(String[] args) {\r\n            String filePath = "output.csv";\r\n    \r\n            try (Writer writer = new BufferedWriter(\r\n                    new OutputStreamWriter(new FileOutputStream(filePath), StandardCharsets.UTF_8))) {\r\n    \r\n                // \u5beb\u5165 CSV \u5167\u5bb9\u524d\u5148\u5beb UTF-8 BOM\r\n                writer.write(\'\\uFEFF\');\r\n    \r\n                // \u5beb\u5165 CSV \u5167\u5bb9\r\n                writer.write("\u59d3\u540d,\u76ee\u7684\\n");\r\n                writer.write("\u8a31\u8339\u82b8,\u53bb\u738b\u529f\u8cb7\u934b\u84cb\\n");\r\n    \r\n                System.out.println("CSV \u5beb\u5165\u5b8c\u6210\uff0c\u5df2\u52a0\u5165 UTF-8 BOM\u3002");\r\n    \r\n            } catch (Exception e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n\n'})}),"\n",(0,i.jsx)(r.h3,{id:"bytes-0xef-0xbb-0xbf",children:"bytes: 0xEF, 0xBB, 0xBF"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"http://koti.mbnet.fi/akini/java/java_utf8_xml/",children:"http://koti.mbnet.fi/akini/java/java_utf8_xml/"})}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-javascript",children:'    public static void saveFile(String data, boolean append) throws IOException {\r\n      String filePath = "output.csv";\r\n      BufferedWriter bw = null;\r\n      OutputStreamWriter osw = null;\r\n \r\n      File f = new File(filePath);\r\n      FileOutputStream fos = new FileOutputStream(f, append);\r\n      try {\r\n         // write UTF8 BOM mark if file is empty\r\n         if (f.length() < 1) {\r\n            final byte[] bom = new byte[] { (byte)0xEF, (byte)0xBB, (byte)0xBF };\r\n            fos.write(bom);\r\n         }\r\n         osw = new OutputStreamWriter(fos, "UTF-8");\r\n         bw = new BufferedWriter(osw);\r\n         if (data != null) bw.write(data);\r\n      } catch (IOException ex) {\r\n         throw ex;\r\n      } finally {\r\n         try { bw.close(); fos.close(); } catch (Exception ex) { }\r\n      }\r\n   }\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\u8996\u9700\u8981\u6dfb\u52a0-utf-8-bom",children:"\u8996\u9700\u8981\u6dfb\u52a0 UTF-8 BOM"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-javascript",children:'    import java.io.*;\r\n    import java.nio.charset.StandardCharsets;\r\n    \r\n    public class AddBomIfMissing {\r\n    \r\n        private String input_csv = "downloaded.csv";\r\n        private String output_csv = "converted_with_bom.csv";\r\n    \r\n        public static void main(String[] args) {\r\n            try {\r\n                File inputFile = new File(input_csv);\r\n                byte[] fileBytes = readAllBytes(inputFile);\r\n    \r\n                // \u6aa2\u67e5\u662f\u5426\u5df2\u6709 UTF-8 BOM (0xEF 0xBB 0xBF)\r\n                boolean hasBOM = fileBytes.length >= 3 &&\r\n                        (fileBytes[0] & 0xFF) == 0xEF &&\r\n                        (fileBytes[1] & 0xFF) == 0xBB &&\r\n                        (fileBytes[2] & 0xFF) == 0xBF;\r\n    \r\n                if (hasBOM) {\r\n                    System.out.println("\u6b64 CSV \u5df2\u6709 UTF-8 BOM\uff0c\u7121\u9700\u8655\u7406\u3002");\r\n                } else {\r\n                    System.out.println("\u6a94\u6848\u7121 BOM\uff0c\u5c07\u6703\u52a0\u5165 UTF-8 BOM \u4e26\u7522\u51fa\u65b0\u6a94\u6848\u3002");\r\n                    // \u52a0\u5165 BOM \u518d\u5beb\u5165\u65b0\u6a94\r\n                    try (OutputStream os = new FileOutputStream(output_csv)) {\r\n                        os.write(0xEF);\r\n                        os.write(0xBB);\r\n                        os.write(0xBF);\r\n                        os.write(fileBytes); \r\n                    }\r\n                    System.out.println("\u65b0\u6a94\u6848\u5beb\u5165\u5b8c\u6210\uff1a" + output_csv);\r\n                }\r\n    \r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n    \r\n        private static byte[] readAllBytes(File file) throws IOException {\r\n            try (InputStream is = new FileInputStream(file)) {\r\n                ByteArrayOutputStream buffer = new ByteArrayOutputStream();\r\n                byte[] data = new byte[4096];\r\n                int nRead;\r\n                while ((nRead = is.read(data, 0, data.length)) != -1) {\r\n                    buffer.write(data, 0, nRead);\r\n                }\r\n                return buffer.toByteArray();\r\n            }\r\n        }\r\n    }\r\n\n'})}),"\n",(0,i.jsx)(r.h2,{id:"\u6bd4\u8f03",children:"\u6bd4\u8f03"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:(0,i.jsx)(r.strong,{children:"\u8aaa\u660e\u9805\u76ee"})}),(0,i.jsx)(r.th,{children:(0,i.jsx)("code",{children:"\\uFEFF"})}),(0,i.jsx)(r.th,{children:(0,i.jsx)("code",{children:"0xEF 0xBB 0xBF"})})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{}),(0,i.jsx)(r.td,{children:"Unicode \u5b57\u5143(U+FEFF)"}),(0,i.jsx)(r.td,{children:"U+FEFF\u5728 UTF-8 \u4e2d\u7684\u7de8\u78bc\u5167\u5bb9"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"\u7528\u6cd5"})}),(0,i.jsx)(r.td,{children:(0,i.jsx)("code",{children:"writer.write('\\uFEFF')"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)("code",{children:"os.write(0xEF);"})," ",(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"os.write(0xBB);"})," ",(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"os.write(0xBF);"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"UTF-8 \u4e0b\u9577\u5ea6"})}),(0,i.jsx)(r.td,{children:"3 bytes"}),(0,i.jsx)(r.td,{children:"3 bytes"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"\u5728 UTF-16/32 \u7528\u9014"})}),(0,i.jsx)(r.td,{children:"\u540c\u6a23\u662f BOM\uff0c\u4f46\u7de8\u78bc\u6210\u4e0d\u540c\u5167\u5bb9"}),(0,i.jsx)(r.td,{children:"\u50c5\u7528\u65bc UTF-8"})]})]})]})]})}function x(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);