"use strict";(self.webpackChunkinsect_totem=self.webpackChunkinsect_totem||[]).push([[3951],{28453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var t=n(96540);const s={},i=t.createContext(s);function a(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:r},e.children)}},46615:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"Java/Java_IP","title":"Java \u53d6 IP","description":"\u4f3a\u670d\u5668 \u5ba2\u7aef IP \u53d6\u5f97\u65b9\u5f0f","source":"@site/docs/110_Java/Java_IP.md","sourceDirName":"110_Java","slug":"/Java/Java_IP","permalink":"/docs/Java/Java_IP","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Java \u53d6 IP","description":"\u4f3a\u670d\u5668 \u5ba2\u7aef IP \u53d6\u5f97\u65b9\u5f0f","keywords":["Java","Han","String"]},"sidebar":"totem_sidebar","previous":{"title":"Excel \u958b\u555f CSV \u767c\u751f\u4e2d\u6587\u4e82\u78bc","permalink":"/docs/Java/Java_CSV_UTF8_BOM"},"next":{"title":"OpenCSV \u8207 CSVParser \u6bd4\u8f03","permalink":"/docs/Java/Java_OpenCSV_CSVParser"}}');var s=n(74848),i=n(28453);const a={title:"Java \u53d6 IP",description:"\u4f3a\u670d\u5668 \u5ba2\u7aef IP \u53d6\u5f97\u65b9\u5f0f",keywords:["Java","Han","String"]},l=void 0,d={},o=[{value:"\u53ef\u80fd\u5f71\u97ff IP \u53d6\u5f97\u539f\u56e0",id:"\u53ef\u80fd\u5f71\u97ff-ip-\u53d6\u5f97\u539f\u56e0",level:2},{value:"\u53d6\u5f97\u672c\u6a5f IP",id:"\u53d6\u5f97\u672c\u6a5f-ip",level:2},{value:"\u53d6\u5f97\u5ba2\u6236\u7aef IP",id:"\u53d6\u5f97\u5ba2\u6236\u7aef-ip",level:2}];function c(e){const r={br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.p,{children:["App Server \u7684\u5be6\u969b IP \u53ef\u80fd\u6703\u53d7\u5230 firewall / switch / Proxy \u7684\u5f71\u97ff",(0,s.jsx)(r.br,{}),"\n","Client \u7aef\u7684 IP \u4e5f\u53ef\u80fd\u5728 servers \u8f49\u4ea4\u9593\u88ab\u907a\u6f0f\u4e86",(0,s.jsx)(r.br,{}),"\n","\u540c\u4e00\u5957\u65b9\u6cd5\u4e5f\u4f3c\u4e4e\u7121\u6cd5\u5b8c\u5168\u6eff\u8db3\u6240\u6709\u9700\u6c42",(0,s.jsx)(r.br,{}),"\n","\u6240\u4ee5\uff0c\u9019\u908a\u5217\u51fa\u66fe\u7d93\u4f7f\u7528\u904e\u7684\u65b9\u5f0f",(0,s.jsx)(r.br,{}),"\n","\u6709\u4e9b\u5728 server \u8abf\u6574\u5f8c\u4fbf\u7121\u6cd5\u4f7f\u7528",(0,s.jsx)(r.br,{}),"\n","\u4e0d\u64d4\u4fdd\u4e00\u5b9a\u80fd\u6709\u4f5c\u7528\uff0c\u50c5\u4f5c\u53c3\u8003"]}),"\n",(0,s.jsx)(r.p,{children:"\u8a3b: \u9019\u908a\u6307\u7684\u4e26\u975e\u76f4\u63a5\u8b80\u53d6\u76f8\u95dc\u8a2d\u5b9a\u6a94"}),"\n",(0,s.jsx)(r.h2,{id:"\u53ef\u80fd\u5f71\u97ff-ip-\u53d6\u5f97\u539f\u56e0",children:"\u53ef\u80fd\u5f71\u97ff IP \u53d6\u5f97\u539f\u56e0"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"App \u662f\u5426\u5b89\u88dd\u5728\u865b\u64ec\u6a5f"}),"\n",(0,s.jsx)(r.li,{children:"\u5916\u5c64\u662f\u5426\u6709 firewall / switch / Proxy"}),"\n",(0,s.jsx)(r.li,{children:"\u5916\u5c64 server \u7684 IP \u76f8\u95dc\u8a2d\u5b9a"}),"\n",(0,s.jsx)(r.li,{children:"load balance \u7684\u8a2d\u5b9a"}),"\n",(0,s.jsx)(r.li,{children:"VPN \u8a2d\u5b9a"}),"\n",(0,s.jsx)(r.li,{children:"hosts \u4e2d\u7684\u8a2d\u5b9a"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\u53d6\u5f97\u672c\u6a5f-ip",children:"\u53d6\u5f97\u672c\u6a5f IP"}),"\n",(0,s.jsxs)(r.p,{children:["\u5225\u8ddf\u6211\u8aaa\u554f MIS \u5c31\u597d\u4e86",(0,s.jsx)(r.br,{}),"\n","\u9019\u53ef\u80fd\u727d\u6d89\u8cc7\u5b89\u554f\u984c\uff0c\u6240\u4ee5\u4e0d\u80fd\u8aaa\uff0c\u4f46\u7570\u5e38\u767c\u751f\u6642\u537b\u8981 App \u5bc4\u4fe1\u901a\u77e5\u76f8\u95dc\u8a2d\u5099\u7ba1\u7406\u54e1",(0,s.jsx)(r.br,{}),"\n","\u4e5f\u6709\u53ef\u80fd\u662f\u56e0\u70ba\u52d5\u614b\u4f48\u7f72\u4e0a\u7684\u554f\u984c\uff0c\u9023\u57f7\u884c\u4f48\u7f72\u7684\u5de5\u7a0b\u5e2b\u90fd\u4e0d\u78ba\u5b9a\uff0c\u53ea\u77e5\u9053 IP \u5340\u9593",(0,s.jsx)(r.br,{}),"\n","\u8cc7\u5b89\u9632\u8b77\u7b49\u6a5f\u9ad8\u7684\u55ae\u4f4d\u4e0b\uff0cMIS \u6709\u6642\u9023 server \u67b6\u69cb\u90fd\u9808\u4fdd\u5bc6",(0,s.jsx)(r.br,{}),"\n","\u6240\u4ee5\u6709\u6642\u9084\u771f\u9ebb\u7169"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"InetAddress"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u5982\u679c\u4f3a\u670d\u5668\u4f4d\u65bc\u9632\u706b\u7246\u6216 NAT \u4e4b\u5f8c\uff0c\u5931\u6548"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:'    import java.net.InetAddress;\r\n    import java.net.UnknownHostException;\r\n    \r\n    private String getLocalAddress() {\r\n        String localAddress = "unknown host";\r\n        try {\r\n            InetAddress address = InetAddress.getLocalHost();\r\n            localAddress = address.getHostAddress();\r\n        } catch (UnknownHostException e1) {\r\n            logger.warn("get local address error!");\r\n        }\r\n        return localAddress;\r\n    }\n'})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"NetworkInterface"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:'    import javax.servlet.http.HttpServletRequest;\r\n    import java.net.InetAddress;\r\n    import java.net.NetworkInterface;\r\n    import java.net.SocketException;\r\n\r\n    public static String getHostAddress() {\r\n\r\n        StringBuilder ifconfig = new StringBuilder();\r\n        String msg = StringUtils.EMPTY;\r\n        try {\r\n            for (Enumeration<NetworkInterface> en = NetworkInterface\r\n                    .getNetworkInterfaces(); en.hasMoreElements();) {\r\n                NetworkInterface intf = en.nextElement();\r\n                for (Enumeration<InetAddress> enumIpAddr = intf\r\n                        .getInetAddresses(); enumIpAddr.hasMoreElements();) {\r\n                    InetAddress inetAddress = enumIpAddr.nextElement();\r\n                    if (!inetAddress.isLoopbackAddress()\r\n                            && !inetAddress.isLinkLocalAddress()\r\n                            && inetAddress.isSiteLocalAddress()) {\r\n                        ifconfig.append(\r\n                                "\\n" + inetAddress.getHostAddress().toString());\r\n                    }\r\n                }\r\n            }\r\n        } catch (SocketException e) {\r\n            e.printStackTrace();\r\n            msg = "InetAddressUtil.getHostAddress() found SocketException : "\r\n                    + e.getMessage();\r\n            logger.info(msg);\r\n            logger.warn(msg);\r\n        }\r\n        return ifconfig.toString();\r\n    }\n'})}),"\n",(0,s.jsx)(r.h2,{id:"\u53d6\u5f97\u5ba2\u6236\u7aef-ip",children:"\u53d6\u5f97\u5ba2\u6236\u7aef IP"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"request.getRemoteAddr()"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u53d6\u76f4\u63a5\u9023\u63a5\u5230 App Server \u7684\u5ba2\u6236\u7aef IP"}),"\n",(0,s.jsx)(r.li,{children:"\u53ef\u80fd\u53ea\u6703\u8fd4\u56de\u4ee3\u7406\u4f3a\u670d\u5668\u7684 IP"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"    import javax.servlet.http.HttpServletRequest;\r\n    import org.apache.wicket.protocol.http.servlet.ServletWebRequest;\r\n\r\n    ServletWebRequest request = ... ;\r\n    request.getRemoteAddr();\r\n    \r\n    HttpServletRequest httpRequest = request.getContainerRequest();\r\n    httpRequest.getRemoteHost();\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"X-Forwarded-For"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u82e5\u6709\u591a\u5c64 servers \u5728\u5916\uff0c\u901a\u5e38\u7b2c\u4e00\u500b\u975e unknown \u7684 IP \u662f\u5ba2\u6236\u7aef\u7684\u771f\u5be6 IP"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:'    import javax.servlet.http.HttpServletRequest;\r\n\r\n    public String getClientIp(HttpServletRequest request) {\r\n        String ip = request.getHeader("X-Forwarded-For");\r\n        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {\r\n            ip = request.getRemoteAddr();\r\n        }\r\n        return ip;\r\n    }\r\n        \n'})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Proxy-Client-IP"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Proxy-Client-IP"}),"\n",(0,s.jsx)(r.li,{children:"WL-Proxy-Client-IP"}),"\n",(0,s.jsx)(r.li,{children:"\u6709\u4e9b server \u6703\u5c07 Client IP \u85cf\u5728\u4e0a\u8ff0 header \u53c3\u6578\u4e2d"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:'    import javax.servlet.http.HttpServletRequest;\r\n    \r\n    public String getRealIp(HttpServletRequest request) {\r\n        String ip = request.getHeader("X-Forwarded-For");\r\n        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {\r\n            ip = request.getHeader("Proxy-Client-IP");\r\n        }\r\n        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {\r\n            ip = request.getHeader("WL-Proxy-Client-IP");\r\n        }\r\n        if (ip == null || ip.isEmpty() || "unknown".equalsIgnoreCase(ip)) {\r\n            ip = request.getRemoteAddr();\r\n        }\r\n        return ip;\r\n    }\n'})})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);