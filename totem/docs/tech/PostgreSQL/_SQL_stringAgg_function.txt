
string_agg() function
查詢時若有使用 group by 語法時
會依指定條件將查出的資料做分組
而同一組中分組條件外其他欄位, 若想顯示時可以利用 string_agg(欄位名, 串接符號) 來取得

ex:
select class_rom, string_agg(student_name, ';') as students from Grade 
       group by class_rom;
=> 查出的結果會是 
========
class_rom, students
甲班, 大明;大強;大俊;大咪
乙班, 小玉;小禎;小俊;小咪




-- 清查ID 生日需校正的部分
select subject_code, 
     string_agg(follow, ',') as follows, 
     string_agg(main_sds, ',') as main_sdss,
     string_agg(raw_data->>'ID_BIRTH', ',') as ID_BIRTHs  
     from dataland_record  where subject_code in (
     
         select subject_code from 
            (select subject_code, 
                   string_agg(main_sds, ',') as main_sdss , 
                   raw_data->>'ID_BIRTH' as ID_BIRTH  
                   from dataland_record group by subject_code, ID_BIRTH order by subject_code
            ) tmp 
        group by subject_code having count(subject_code) >1) 
        
    group by subject_code order by subject_code;

    
-- 清查REAL 生日需校正的部分
select subject_code, 
     string_agg(follow, ',') as follows, 
     string_agg(main_sds, ',') as main_sdss,
     string_agg(raw_data->>'REAL_BIRTH', ',') as REAL_BIRTHs  
     from dataland_record  where subject_code in (
     
         select subject_code from 
            (select subject_code, 
                   string_agg(main_sds, ',') as main_sdss , 
                   raw_data->>'REAL_BIRTH' as REAL_BIRTH  
                   from dataland_record group by subject_code, REAL_BIRTH order by subject_code
            ) tmp 
        group by subject_code having count(subject_code) >1) 
        
    group by subject_code order by subject_code;